var Bs=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{};function vn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ha(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}const z=typeof globalThis<"u"?globalThis:typeof self<"u"?self:window,J=Object.keys,te=Array.isArray;function ne(e,t){return typeof t!="object"||J(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||z.Promise||(z.Promise=Promise);const at=Object.getPrototypeOf,fa={}.hasOwnProperty;function se(e,t){return fa.call(e,t)}function ze(e,t){typeof t=="function"&&(t=t(at(e))),(typeof Reflect>"u"?J:Reflect.ownKeys)(t).forEach(r=>{_e(e,r,t[r])})}const yn=Object.defineProperty;function _e(e,t,r,n){yn(e,t,ne(r&&se(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function qe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),_e(e.prototype,"constructor",e),{extend:ze.bind(null,e.prototype)}}}}const da=Object.getOwnPropertyDescriptor;function Dr(e,t){let r;return da(e,t)||(r=at(e))&&Dr(r,t)}const pa=[].slice;function Tt(e,t,r){return pa.call(e,t,r)}function gn(e,t){return t(e)}function Je(e){if(!e)throw new Error("Assertion Failed")}function mn(e){z.setImmediate?setImmediate(e):setTimeout(e,0)}function wn(e,t){return e.reduce((r,n,a)=>{var i=t(n,a);return i&&(r[i[0]]=i[1]),r},{})}function ke(e,t){if(typeof t=="string"&&se(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,a=t.length;n<a;++n){var i=ke(e,t[n]);r.push(i)}return r}var s=t.indexOf(".");if(s!==-1){var u=e[t.substr(0,s)];return u===void 0?void 0:ke(u,t.substr(s+1))}}function he(e,t,r){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Je(typeof r!="string"&&"length"in r);for(var n=0,a=t.length;n<a;++n)he(e,t[n],r[n])}else{var i=t.indexOf(".");if(i!==-1){var s=t.substr(0,i),u=t.substr(i+1);if(u==="")r===void 0?te(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=r;else{var o=e[s];o&&se(e,s)||(o=e[s]={}),he(o,u,r)}}else r===void 0?te(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function bn(e){var t={};for(var r in e)se(e,r)&&(t[r]=e[r]);return t}const va=[].concat;function _n(e){return va.apply([],e)}const kn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(_n([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>z[e]),ya=kn.map(e=>z[e]);wn(kn,e=>[e,!0]);let xe=null;function dt(e){xe=typeof WeakMap<"u"&&new WeakMap;const t=nr(e);return xe=null,t}function nr(e){if(!e||typeof e!="object")return e;let t=xe&&xe.get(e);if(t)return t;if(te(e)){t=[],xe&&xe.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(nr(e[r]))}else if(ya.indexOf(e.constructor)>=0)t=e;else{const i=at(e);for(var a in t=i===Object.prototype?{}:Object.create(i),xe&&xe.set(e,t),e)se(e,a)&&(t[a]=nr(e[a]))}return t}const{toString:ga}={};function ar(e){return ga.call(e).slice(8,-1)}const ir=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ma=typeof ir=="symbol"?function(e){var t;return e!=null&&(t=e[ir])&&t.apply(e)}:function(){return null},Le={};function we(e){var t,r,n,a;if(arguments.length===1){if(te(e))return e.slice();if(this===Le&&typeof e=="string")return[e];if(a=ma(e)){for(r=[];!(n=a.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const Rr=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var pe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function En(e,t){pe=e,An=t}var An=()=>!0;const wa=!new Error("").stack;function Ke(){if(wa)try{throw Ke.arguments,new Error}catch(e){return e}return new Error}function sr(e,t){var r=e.stack;return r?(t=t||0,r.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),r.split(`
`).slice(t).filter(An).map(n=>`
`+n).join("")):""}var xn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Kr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(xn),ba={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ue(e,t){this._e=Ke(),this.name=e,this.message=t}function Pn(e,t){return e+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,n,a)=>a.indexOf(r)===n).join(`
`)}function St(e,t,r,n){this._e=Ke(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Pn(e,t)}function Qe(e,t){this._e=Ke(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=Pn(e,t)}qe(Ue).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+sr(this._e,2))}},toString:function(){return this.name+": "+this.message}}),qe(St).from(Ue),qe(Qe).from(Ue);var Fr=Kr.reduce((e,t)=>(e[t]=t+"Error",e),{});const _a=Ue;var S=Kr.reduce((e,t)=>{var r=t+"Error";function n(a,i){this._e=Ke(),this.name=r,a?typeof a=="string"?(this.message=`${a}${i?`
 `+i:""}`,this.inner=i||null):typeof a=="object"&&(this.message=`${a.name} ${a.message}`,this.inner=a):(this.message=ba[t]||r,this.inner=null)}return qe(n).from(_a),e[t]=n,e},{});S.Syntax=SyntaxError,S.Type=TypeError,S.Range=RangeError;var Hr=xn.reduce((e,t)=>(e[t+"Error"]=S[t],e),{}),Et=Kr.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=S[t]),e),{});function q(){}function it(e){return e}function ka(e,t){return e==null||e===it?t:function(r){return t(e(r))}}function De(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ea(e,t){return e===q?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?De(n,this.onsuccess):n),a&&(this.onerror=this.onerror?De(a,this.onerror):a),i!==void 0?i:r}}function Aa(e,t){return e===q?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?De(r,this.onsuccess):r),n&&(this.onerror=this.onerror?De(n,this.onerror):n)}}function xa(e,t){return e===q?t:function(r){var n=e.apply(this,arguments);ne(r,n);var a=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?De(a,this.onsuccess):a),i&&(this.onerror=this.onerror?De(i,this.onerror):i),n===void 0?s===void 0?void 0:s:ne(n,s)}}function Pa(e,t){return e===q?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Nr(e,t){return e===q?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return r.then(function(){return t.apply(n,i)})}return t.apply(this,arguments)}}Et.ModifyError=St,Et.DexieError=Ue,Et.BulkError=Qe;var st={};const jn=100,[or,Ct,ur]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,at(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,at(t),e]})(),Mn=Ct&&Ct.then,At=or&&or.constructor,Lr=!!ur;var lr=!1,ja=ur?()=>{ur.then(yt)}:z.setImmediate?setImmediate.bind(null,yt):z.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{yt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(yt,0)},Xe=function(e,t){Ze.push([e,t]),Bt&&(ja(),Bt=!1)},cr=!0,Bt=!0,Be=[],xt=[],hr=null,fr=it,$e={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Qr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Qr(e[0],e[1])}catch{}})}},T=$e,Ze=[],Ie=0,Pt=[];function O(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=q,this._lib=!1;var t=this._PSD=T;if(pe&&(this._stackHolder=Ke(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==st)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&pr(this,this._value))}this._state=null,this._value=null,++t.ref,Tn(this,e)}const dr={get:function(){var e=T,t=It;function r(n,a){var i=!e.global&&(e!==T||t!==It);const s=i&&!Ee();var u=new O((o,h)=>{qr(this,new On(Dt(n,e,i,s),Dt(a,e,i,s),o,h,e))});return pe&&Bn(u,this),u}return r.prototype=st,r},set:function(e){_e(this,"then",e&&e.prototype===st?dr:{get:function(){return e},set:dr.set})}};function On(e,t,r,n,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=a}function Tn(e,t){try{t(r=>{if(e._state===null){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&pt();r&&typeof r.then=="function"?Tn(e,(a,i)=>{r instanceof O?r._then(a,i):r.then(a,i)}):(e._state=!0,e._value=r,Sn(e)),n&&vt()}},pr.bind(null,e))}catch(r){pr(e,r)}}function pr(e,t){if(xt.push(t),e._state===null){var r=e._lib&&pt();t=fr(t),e._state=!1,e._value=t,pe&&t!==null&&typeof t=="object"&&!t._promise&&function(n,a,i){try{n.apply(null,i)}catch(s){a&&a(s)}}(()=>{var n=Dr(t,"stack");t._promise=e,_e(t,"stack",{get:()=>lr?n&&(n.get?n.get.apply(t):n.value):e.stack})}),function(n){Be.some(a=>a._value===n._value)||Be.push(n)}(e),Sn(e),r&&vt()}}function Sn(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)qr(e,t[r]);var a=e._PSD;--a.ref||a.finalize(),Ie===0&&(++Ie,Xe(()=>{--Ie==0&&Ur()},[]))}function qr(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ie,Xe(Ma,[r,e,t])}else e._listeners.push(t)}function Ma(e,t,r){try{hr=t;var n,a=t._value;t._state?n=e(a):(xt.length&&(xt=[]),n=e(a),xt.indexOf(a)===-1&&function(i){for(var s=Be.length;s;)if(Be[--s]._value===i._value)return void Be.splice(s,1)}(t)),r.resolve(n)}catch(i){r.reject(i)}finally{hr=null,--Ie==0&&Ur(),--r.psd.ref||r.psd.finalize()}}function Cn(e,t,r){if(t.length===r)return t;var n="";if(e._state===!1){var a,i,s=e._value;s!=null?(a=s.name||"Error",i=s.message||s,n=sr(s,0)):(a=s,i=""),t.push(a+(i?": "+i:"")+n)}return pe&&((n=sr(e._stackHolder,2))&&t.indexOf(n)===-1&&t.push(n),e._prev&&Cn(e._prev,t,r)),t}function Bn(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function yt(){pt()&&vt()}function pt(){var e=cr;return cr=!1,Bt=!1,e}function vt(){var e,t,r;do for(;Ze.length>0;)for(e=Ze,Ze=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(Ze.length>0);cr=!0,Bt=!0}function Ur(){var e=Be;Be=[],e.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var t=Pt.slice(0),r=t.length;r;)t[--r]()}function gt(e){return new O(st,!1,e)}function V(e,t){var r=T;return function(){var n=pt(),a=T;try{return Oe(r,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{Oe(a,!1),n&&vt()}}}ze(O.prototype,{then:dr,_then:function(e,t){qr(this,new On(null,null,e,t,T))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,n=>n instanceof t?r(n):gt(n)):this.then(null,n=>n&&n.name===t?r(n):gt(n))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),gt(t)))},stack:{get:function(){if(this._stack)return this._stack;try{lr=!0;var e=Cn(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{lr=!1}}},timeout:function(e,t){return e<1/0?new O((r,n)=>{var a=setTimeout(()=>n(new S.Timeout(t)),e);this.then(r,n).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&_e(O.prototype,Symbol.toStringTag,"Dexie.Promise"),$e.env=In(),ze(O,{all:function(){var e=we.apply(null,arguments).map(mt);return new O(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach((a,i)=>O.resolve(a).then(s=>{e[i]=s,--n||t(e)},r))})},resolve:e=>{if(e instanceof O)return e;if(e&&typeof e.then=="function")return new O((r,n)=>{e.then(r,n)});var t=new O(st,!0,e);return Bn(t,hr),t},reject:gt,race:function(){var e=we.apply(null,arguments).map(mt);return new O((t,r)=>{e.map(n=>O.resolve(n).then(t,r))})},PSD:{get:()=>T,set:e=>T=e},totalEchoes:{get:()=>It},newPSD:Me,usePSD:We,scheduler:{get:()=>Xe,set:e=>{Xe=e}},rejectionMapper:{get:()=>fr,set:e=>{fr=e}},follow:(e,t)=>new O((r,n)=>Me((a,i)=>{var s=T;s.unhandleds=[],s.onunhandled=i,s.finalize=De(function(){(function(u){function o(){u(),Pt.splice(Pt.indexOf(o),1)}Pt.push(o),++Ie,Xe(()=>{--Ie==0&&Ur()},[])})(()=>{this.unhandleds.length===0?a():i(this.unhandleds[0])})},s.finalize),e()},t,r,n))}),At&&(At.allSettled&&_e(O,"allSettled",function(){const e=we.apply(null,arguments).map(mt);return new O(t=>{e.length===0&&t([]);let r=e.length;const n=new Array(r);e.forEach((a,i)=>O.resolve(a).then(s=>n[i]={status:"fulfilled",value:s},s=>n[i]={status:"rejected",reason:s}).then(()=>--r||t(n)))})}),At.any&&typeof AggregateError<"u"&&_e(O,"any",function(){const e=we.apply(null,arguments).map(mt);return new O((t,r)=>{e.length===0&&r(new AggregateError([]));let n=e.length;const a=new Array(n);e.forEach((i,s)=>O.resolve(i).then(u=>t(u),u=>{a[s]=u,--n||r(new AggregateError(a))}))})}));const ee={awaits:0,echoes:0,id:0};var Oa=0,jt=[],Ht=0,It=0,Ta=0;function Me(e,t,r,n){var a=T,i=Object.create(a);i.parent=a,i.ref=0,i.global=!1,i.id=++Ta;var s=$e.env;i.env=Lr?{Promise:O,PromiseProp:{value:O,configurable:!0,writable:!0},all:O.all,race:O.race,allSettled:O.allSettled,any:O.any,resolve:O.resolve,reject:O.reject,nthen:Jr(s.nthen,i),gthen:Jr(s.gthen,i)}:{},t&&ne(i,t),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=We(i,e,r,n);return i.ref===0&&i.finalize(),u}function Ve(){return ee.id||(ee.id=++Oa),++ee.awaits,ee.echoes+=jn,ee.id}function Ee(){return!!ee.awaits&&(--ee.awaits==0&&(ee.id=0),ee.echoes=ee.awaits*jn,!0)}function mt(e){return ee.echoes&&e&&e.constructor===At?(Ve(),e.then(t=>(Ee(),t),t=>(Ee(),Q(t)))):e}function Sa(e){++It,ee.echoes&&--ee.echoes!=0||(ee.echoes=ee.id=0),jt.push(T),Oe(e,!0)}function Ca(){var e=jt[jt.length-1];jt.pop(),Oe(e,!1)}function Oe(e,t){var r=T;if((t?!ee.echoes||Ht++&&e===T:!Ht||--Ht&&e===T)||Dn(t?Sa.bind(null,e):Ca),e!==T&&(T=e,r===$e&&($e.env=In()),Lr)){var n=$e.env.Promise,a=e.env;Ct.then=a.nthen,n.prototype.then=a.gthen,(r.global||e.global)&&(Object.defineProperty(z,"Promise",a.PromiseProp),n.all=a.all,n.race=a.race,n.resolve=a.resolve,n.reject=a.reject,a.allSettled&&(n.allSettled=a.allSettled),a.any&&(n.any=a.any))}}function In(){var e=z.Promise;return Lr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(z,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Ct.then,gthen:e.prototype.then}:{}}function We(e,t,r,n,a){var i=T;try{return Oe(e,!0),t(r,n,a)}finally{Oe(i,!1)}}function Dn(e){Mn.call(or,e)}function Dt(e,t,r,n){return typeof e!="function"?e:function(){var a=T;r&&Ve(),Oe(t,!0);try{return e.apply(this,arguments)}finally{Oe(a,!1),n&&Dn(Ee)}}}function Jr(e,t){return function(r,n){return e.call(this,Dt(r,t),Dt(n,t))}}(""+Mn).indexOf("[native code]")===-1&&(Ve=Ee=q);const Zr="unhandledrejection";function Qr(e,t){var r;try{r=t.onuncatched(e)}catch{}if(r!==!1)try{var n,a={promise:t,reason:e};if(z.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(Zr,!0,!0),ne(n,a)):z.CustomEvent&&ne(n=new CustomEvent(Zr,{detail:a}),a),n&&z.dispatchEvent&&(dispatchEvent(n),!z.PromiseRejectionEvent&&z.onunhandledrejection))try{z.onunhandledrejection(n)}catch{}pe&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var Q=O.reject;function vr(e,t,r,n){if(e.idbdb&&(e._state.openComplete||T.letThrough||e._vip)){var a=e._createTransaction(t,r,e._dbSchema);try{a.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Fr.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>vr(e,t,r,n))):Q(i)}return a._promise(t,(i,s)=>Me(()=>(T.trans=a,n(i,s,a)))).then(i=>a._completion.then(()=>i))}if(e._state.openComplete)return Q(new S.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Q(new S.DatabaseClosed);e.open().catch(q)}return e._state.dbReadyPromise.then(()=>vr(e,t,r,n))}const Xr="3.2.5",Ce="￿",yr=-1/0,ge="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Rn="String expected.",et=[],Lt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ba=Lt,Ia=Lt,Kn=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),qt="__dbnames",Jt="readonly",Zt="readwrite";function Re(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Fn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function wt(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=dt(t))[e],t)}class Da{_trans(t,r,n){const a=this._tx||T.trans,i=this.name;function s(o,h,l){if(!l.schema[i])throw new S.NotFound("Table "+i+" not part of transaction");return r(l.idbtrans,l)}const u=pt();try{return a&&a.db===this.db?a===T.trans?a._promise(t,s,n):Me(()=>a._promise(t,s,n),{trans:a,transless:T.transless||T}):vr(this.db,t,[this.name],s)}finally{u&&vt()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:t}).then(a=>this.hook.reading.fire(a))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(te(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=J(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(h=>{if(h.compound&&r.every(l=>h.keyPath.indexOf(l)>=0)){for(let l=0;l<r.length;++l)if(r.indexOf(h.keyPath[l])===-1)return!1;return!0}return!1}).sort((h,l)=>h.keyPath.length-l.keyPath.length)[0];if(n&&this.db._maxKey!==Ce){const h=n.keyPath.slice(0,r.length);return this.where(h).equals(h.map(l=>t[l]))}!n&&pe&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:a}=this.schema,i=this.db._deps.indexedDB;function s(h,l){try{return i.cmp(h,l)===0}catch{return!1}}const[u,o]=r.reduce(([h,l],c)=>{const f=a[c],p=t[c];return[h||f,h||!f?Re(l,f&&f.multi?m=>{const g=ke(m,c);return te(g)&&g.some(d=>s(p,d))}:m=>s(p,ke(m,c))):l]},[null,null]);return u?this.where(u.name).equals(t[u.keyPath]).filter(o):n?this.filter(o):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,te(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const r=n=>{if(!n)return n;const a=Object.create(t.prototype);for(var i in n)if(se(n,i))try{a[i]=n[i]}catch{}return a};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t}defineClass(){return this.mapToClass(function(t){ne(this,t)})}add(t,r){const{auto:n,keyPath:a}=this.schema.primKey;let i=t;return a&&n&&(i=wt(a)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:r!=null?[r]:null,values:[i]})).then(s=>s.numFailures?O.reject(s.failures[0]):s.lastResult).then(s=>{if(a)try{he(t,a,s)}catch{}return s})}update(t,r){if(typeof t!="object"||te(t))return this.where(":id").equals(t).modify(r);{const n=ke(t,this.schema.primKey.keyPath);if(n===void 0)return Q(new S.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?J(r).forEach(a=>{he(t,a,r[a])}):r(t,{value:t,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(t,r){const{auto:n,keyPath:a}=this.schema.primKey;let i=t;return a&&n&&(i=wt(a)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[i],keys:r!=null?[r]:null})).then(s=>s.numFailures?O.reject(s.failures[0]):s.lastResult).then(s=>{if(a)try{he(t,a,s)}catch{}return s})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?O.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Fn})).then(t=>t.numFailures?O.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(n=>n.map(a=>this.hook.reading.fire(a))))}bulkAdd(t,r,n){const a=Array.isArray(r)?r:void 0,i=(n=n||(a?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:u,keyPath:o}=this.schema.primKey;if(o&&a)throw new S.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const h=t.length;let l=o&&u?t.map(wt(o)):t;return this.core.mutate({trans:s,type:"add",keys:a,values:l,wantResults:i}).then(({numFailures:c,results:f,lastResult:p,failures:m})=>{if(c===0)return i?f:p;throw new Qe(`${this.name}.bulkAdd(): ${c} of ${h} operations failed`,m)})})}bulkPut(t,r,n){const a=Array.isArray(r)?r:void 0,i=(n=n||(a?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:u,keyPath:o}=this.schema.primKey;if(o&&a)throw new S.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const h=t.length;let l=o&&u?t.map(wt(o)):t;return this.core.mutate({trans:s,type:"put",keys:a,values:l,wantResults:i}).then(({numFailures:c,results:f,lastResult:p,failures:m})=>{if(c===0)return i?f:p;throw new Qe(`${this.name}.bulkPut(): ${c} of ${h} operations failed`,m)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:t})).then(({numFailures:n,lastResult:a,failures:i})=>{if(n===0)return a;throw new Qe(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,i)})}}function tt(e){var t={},r=function(s,u){if(u){for(var o=arguments.length,h=new Array(o-1);--o;)h[o-1]=arguments[o];return t[s].subscribe.apply(null,h),e}if(typeof s=="string")return t[s]};r.addEventType=i;for(var n=1,a=arguments.length;n<a;++n)i(arguments[n]);return r;function i(s,u,o){if(typeof s!="object"){var h;u||(u=Pa),o||(o=q);var l={subscribers:[],fire:o,subscribe:function(c){l.subscribers.indexOf(c)===-1&&(l.subscribers.push(c),l.fire=u(l.fire,c))},unsubscribe:function(c){l.subscribers=l.subscribers.filter(function(f){return f!==c}),l.fire=l.subscribers.reduce(u,o)}};return t[s]=r[s]=l,l}J(h=s).forEach(function(c){var f=h[c];if(te(f))i(c,h[c][0],h[c][1]);else{if(f!=="asap")throw new S.InvalidArgument("Invalid event config");var p=i(c,it,function(){for(var m=arguments.length,g=new Array(m);m--;)g[m]=arguments[m];p.subscribers.forEach(function(d){mn(function(){d.apply(null,g)})})})}})}}function He(e,t){return qe(t).from({prototype:e}),t}function Fe(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Qt(e,t){e.filter=Re(e.filter,t)}function Xt(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>Re(n(),t()):t,e.justLimit=r&&!n}function Mt(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new S.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function en(e,t,r){const n=Mt(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function bt(e,t,r,n){const a=e.replayFilter?Re(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},s=(u,o,h)=>{if(!a||a(o,h,f=>o.stop(f),f=>o.fail(f))){var l=o.primaryKey,c=""+l;c==="[object ArrayBuffer]"&&(c=""+new Uint8Array(l)),se(i,c)||(i[c]=!0,t(u,o,h))}};return Promise.all([e.or._iterate(s,r),tn(en(e,n,r),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return tn(en(e,n,r),Re(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function tn(e,t,r,n){var a=V(n?(i,s,u)=>r(n(i),s,u):r);return e.then(i=>{if(i)return i.start(()=>{var s=()=>i.continue();t&&!t(i,u=>s=u,u=>{i.stop(u),s=q},u=>{i.fail(u),s=q})||a(i.value,i,u=>s=u),s()})})}function re(e,t){try{const r=rn(e),n=rn(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(a,i){const s=a.length,u=i.length,o=s<u?s:u;for(let h=0;h<o;++h)if(a[h]!==i[h])return a[h]<i[h]?-1:1;return s===u?0:s<u?-1:1}(nn(e),nn(t));case"Array":return function(a,i){const s=a.length,u=i.length,o=s<u?s:u;for(let h=0;h<o;++h){const l=re(a[h],i[h]);if(l!==0)return l}return s===u?0:s<u?-1:1}(e,t)}}catch{}return NaN}function rn(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const r=ar(e);return r==="ArrayBuffer"?"binary":r}function nn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Ra{_read(t,r){var n=this._ctx;return n.error?n.table._trans(null,Q.bind(null,n.error)):n.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,Q.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=Re(r.algorithm,t)}_iterate(t,r){return bt(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&ne(n,t),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(n=>bt(r,t,n,r.table.core))}count(t){return this._read(r=>{const n=this._ctx,a=n.table.core;if(Fe(n,!0))return a.count({trans:r,query:{index:Mt(n,a.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var i=0;return bt(n,()=>(++i,!1),r,a).then(()=>i)}).then(t)}sortBy(t,r){const n=t.split(".").reverse(),a=n[0],i=n.length-1;function s(h,l){return l?s(h[n[l]],l-1):h[a]}var u=this._ctx.dir==="next"?1:-1;function o(h,l){var c=s(h,i),f=s(l,i);return c<f?-u:c>f?u:0}return this.toArray(function(h){return h.sort(o)}).then(r)}toArray(t){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&Fe(n,!0)&&n.limit>0){const{valueMapper:a}=n,i=Mt(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(({result:s})=>a?s.map(a):s)}{const a=[];return bt(n,i=>a.push(i),r,n.table.core).then(()=>a)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,Fe(r)?Xt(r,()=>{var n=t;return(a,i)=>n===0||(n===1?(--n,!1):(i(()=>{a.advance(n),n=0}),!1))}):Xt(r,()=>{var n=t;return()=>--n<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Xt(this._ctx,()=>{var r=t;return function(n,a,i){return--r<=0&&a(i),r>=0}},!0),this}until(t,r){return Qt(this._ctx,function(n,a,i){return!t(n.value)||(a(i),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,n;return Qt(this._ctx,function(a){return t(a.value)}),r=this._ctx,n=t,r.isMatch=Re(r.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,a){t(a.key,a)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,a){t(a.primaryKey,a)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(a,i){n.push(i.key)}).then(function(){return n}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&Fe(r,!0)&&r.limit>0)return this._read(a=>{var i=Mt(r,r.table.core.schema);return r.table.core.query({trans:a,values:!1,limit:r.limit,query:{index:i,range:r.range}})}).then(({result:a})=>a).then(t);r.keysOnly=!r.isMatch;var n=[];return this.each(function(a,i){n.push(i.primaryKey)}).then(function(){return n}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var n={};return Qt(this._ctx,function(a){var i=a.primaryKey.toString(),s=se(n,i);return n[i]=!0,!s}),this}modify(t){var r=this._ctx;return this._write(n=>{var a;if(typeof t=="function")a=t;else{var i=J(t),s=i.length;a=function(g){for(var d=!1,v=0;v<s;++v){var y=i[v],w=t[y];ke(g,y)!==w&&(he(g,y,w),d=!0)}return d}}const u=r.table.core,{outbound:o,extractKey:h}=u.schema.primaryKey,l=this.db._options.modifyChunkSize||200,c=[];let f=0;const p=[],m=(g,d)=>{const{failures:v,numFailures:y}=d;f+=g-y;for(let w of J(v))c.push(v[w])};return this.clone().primaryKeys().then(g=>{const d=v=>{const y=Math.min(l,g.length-v);return u.getMany({trans:n,keys:g.slice(v,v+y),cache:"immutable"}).then(w=>{const b=[],_=[],A=o?[]:null,E=[];for(let P=0;P<y;++P){const I=w[P],C={value:dt(I),primKey:g[v+P]};a.call(C,C.value,C)!==!1&&(C.value==null?E.push(g[v+P]):o||re(h(I),h(C.value))===0?(_.push(C.value),o&&A.push(g[v+P])):(E.push(g[v+P]),b.push(C.value)))}const M=Fe(r)&&r.limit===1/0&&(typeof t!="function"||t===er)&&{index:r.index,range:r.range};return Promise.resolve(b.length>0&&u.mutate({trans:n,type:"add",values:b}).then(P=>{for(let I in P.failures)E.splice(parseInt(I),1);m(b.length,P)})).then(()=>(_.length>0||M&&typeof t=="object")&&u.mutate({trans:n,type:"put",keys:A,values:_,criteria:M,changeSpec:typeof t!="function"&&t}).then(P=>m(_.length,P))).then(()=>(E.length>0||M&&t===er)&&u.mutate({trans:n,type:"delete",keys:E,criteria:M}).then(P=>m(E.length,P))).then(()=>g.length>v+y&&d(v+l))})};return d(0).then(()=>{if(c.length>0)throw new St("Error modifying one or more objects",c,f,p);return g.length})})})}delete(){var t=this._ctx,r=t.range;return Fe(t)&&(t.isPrimKey&&!Ia||r.type===3)?this._write(n=>{const{primaryKey:a}=t.table.core.schema,i=r;return t.table.core.count({trans:n,query:{index:a,range:i}}).then(s=>t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(({failures:u,lastResult:o,results:h,numFailures:l})=>{if(l)throw new St("Could not delete some values",Object.keys(u).map(c=>u[c]),s-l);return s-l}))}):this.modify(er)}}const er=(e,t)=>t.value=null;function Ka(e,t){return e<t?-1:e===t?0:1}function Fa(e,t){return e>t?-1:e===t?0:1}function ie(e,t,r){var n=e instanceof Ln?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function Ne(e){return new e.Collection(e,()=>Nn("")).limit(0)}function Na(e,t,r,n,a,i){for(var s=Math.min(e.length,n.length),u=-1,o=0;o<s;++o){var h=t[o];if(h!==n[o])return a(e[o],r[o])<0?e.substr(0,o)+r[o]+r.substr(o+1):a(e[o],n[o])<0?e.substr(0,o)+n[o]+r.substr(o+1):u>=0?e.substr(0,u)+t[u]+r.substr(u+1):null;a(e[o],h)<0&&(u=o)}return s<n.length&&i==="next"?e+r.substr(e.length):s<e.length&&i==="prev"?e.substr(0,r.length):u<0?null:e.substr(0,u)+n[u]+r.substr(u+1)}function _t(e,t,r,n){var a,i,s,u,o,h,l,c=r.length;if(!r.every(g=>typeof g=="string"))return ie(e,Rn);function f(g){a=function(v){return v==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(g),i=function(v){return v==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(g),s=g==="next"?Ka:Fa;var d=r.map(function(v){return{lower:i(v),upper:a(v)}}).sort(function(v,y){return s(v.lower,y.lower)});u=d.map(function(v){return v.upper}),o=d.map(function(v){return v.lower}),h=g,l=g==="next"?"":n}f("next");var p=new e.Collection(e,()=>Ae(u[0],o[c-1]+n));p._ondirectionchange=function(g){f(g)};var m=0;return p._addAlgorithm(function(g,d,v){var y=g.key;if(typeof y!="string")return!1;var w=i(y);if(t(w,o,m))return!0;for(var b=null,_=m;_<c;++_){var A=Na(y,w,u[_],o[_],s,h);A===null&&b===null?m=_+1:(b===null||s(b,A)>0)&&(b=A)}return d(b!==null?function(){g.continue(b+l)}:v),!1}),p}function Ae(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Nn(e){return{type:1,lower:e,upper:e}}class Ln{get Collection(){return this._ctx.table.db.Collection}between(t,r,n,a){n=n!==!1,a=a===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(n||a)&&(!n||!a)?Ne(this):new this.Collection(this,()=>Ae(t,r,!n,!a))}catch{return ie(this,ge)}}equals(t){return t==null?ie(this,ge):new this.Collection(this,()=>Nn(t))}above(t){return t==null?ie(this,ge):new this.Collection(this,()=>Ae(t,void 0,!0))}aboveOrEqual(t){return t==null?ie(this,ge):new this.Collection(this,()=>Ae(t,void 0,!1))}below(t){return t==null?ie(this,ge):new this.Collection(this,()=>Ae(void 0,t,!1,!0))}belowOrEqual(t){return t==null?ie(this,ge):new this.Collection(this,()=>Ae(void 0,t))}startsWith(t){return typeof t!="string"?ie(this,Rn):this.between(t,t+Ce,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):_t(this,(r,n)=>r.indexOf(n[0])===0,[t],Ce)}equalsIgnoreCase(t){return _t(this,(r,n)=>r===n[0],[t],"")}anyOfIgnoreCase(){var t=we.apply(Le,arguments);return t.length===0?Ne(this):_t(this,(r,n)=>n.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=we.apply(Le,arguments);return t.length===0?Ne(this):_t(this,(r,n)=>n.some(a=>r.indexOf(a)===0),t,Ce)}anyOf(){const t=we.apply(Le,arguments);let r=this._cmp;try{t.sort(r)}catch{return ie(this,ge)}if(t.length===0)return Ne(this);const n=new this.Collection(this,()=>Ae(t[0],t[t.length-1]));n._ondirectionchange=i=>{r=i==="next"?this._ascending:this._descending,t.sort(r)};let a=0;return n._addAlgorithm((i,s,u)=>{const o=i.key;for(;r(o,t[a])>0;)if(++a,a===t.length)return s(u),!1;return r(o,t[a])===0||(s(()=>{i.continue(t[a])}),!1)}),n}notEqual(t){return this.inAnyRange([[yr,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=we.apply(Le,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ie(this,ge)}const r=t.reduce((n,a)=>n?n.concat([[n[n.length-1][1],a]]):[[yr,a]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const n=this._cmp,a=this._ascending,i=this._descending,s=this._min,u=this._max;if(t.length===0)return Ne(this);if(!t.every(y=>y[0]!==void 0&&y[1]!==void 0&&a(y[0],y[1])<=0))return ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",S.InvalidArgument);const o=!r||r.includeLowers!==!1,h=r&&r.includeUppers===!0;let l,c=a;function f(y,w){return c(y[0],w[0])}try{l=t.reduce(function(y,w){let b=0,_=y.length;for(;b<_;++b){const A=y[b];if(n(w[0],A[1])<0&&n(w[1],A[0])>0){A[0]=s(A[0],w[0]),A[1]=u(A[1],w[1]);break}}return b===_&&y.push(w),y},[]),l.sort(f)}catch{return ie(this,ge)}let p=0;const m=h?y=>a(y,l[p][1])>0:y=>a(y,l[p][1])>=0,g=o?y=>i(y,l[p][0])>0:y=>i(y,l[p][0])>=0;let d=m;const v=new this.Collection(this,()=>Ae(l[0][0],l[l.length-1][1],!o,!h));return v._ondirectionchange=y=>{y==="next"?(d=m,c=a):(d=g,c=i),l.sort(f)},v._addAlgorithm((y,w,b)=>{for(var _=y.key;d(_);)if(++p,p===l.length)return w(b),!1;return!!function(A){return!m(A)&&!g(A)}(_)||(this._cmp(_,l[p][1])===0||this._cmp(_,l[p][0])===0||w(()=>{c===a?y.continue(l[p][0]):y.continue(l[p][1])}),!1)}),v}startsWithAnyOf(){const t=we.apply(Le,arguments);return t.every(r=>typeof r=="string")?t.length===0?Ne(this):this.inAnyRange(t.map(r=>[r,r+Ce])):ie(this,"startsWithAnyOf() only works with strings")}}function de(e){return V(function(t){return ot(t),e(t.target.error),!1})}function ot(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const ut="storagemutated",Pe="x-storagemutated-1",Te=tt(null,ut);class La{_lock(){return Je(!T.global),++this._reculock,this._reculock!==1||T.global||(T.lockOwnerFor=this),this}_unlock(){if(Je(!T.global),--this._reculock==0)for(T.global||(T.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{We(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&T.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(Je(!this.idbtrans),!t&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new S.DatabaseClosed(n);case"MissingAPIError":throw new S.MissingAPI(n.message,n);default:throw new S.OpenFailed(n)}if(!this.active)throw new S.TransactionInactive;return Je(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=V(a=>{ot(a),this._reject(t.error)}),t.onabort=V(a=>{ot(a),this.active&&this._reject(new S.Abort(t.error)),this.active=!1,this.on("abort").fire(a)}),t.oncomplete=V(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&Te.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,n){if(t==="readwrite"&&this.mode!=="readwrite")return Q(new S.ReadOnly("Transaction is readonly"));if(!this.active)return Q(new S.TransactionInactive);if(this._locked())return new O((i,s)=>{this._blockedFuncs.push([()=>{this._promise(t,r,n).then(i,s)},T])});if(n)return Me(()=>{var i=new O((s,u)=>{this._lock();const o=r(s,u,this);o&&o.then&&o.then(s,u)});return i.finally(()=>this._unlock()),i._lib=!0,i});var a=new O((i,s)=>{var u=r(i,s,this);u&&u.then&&u.then(i,s)});return a._lib=!0,a}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const n=O.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var a=r.idbtrans.objectStore(r.storeNames[0]);(function s(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(a.get(-1/0).onsuccess=s)})()}var i=r._waitingFor;return new O((s,u)=>{n.then(o=>r._waitingQueue.push(V(s.bind(null,o))),o=>r._waitingQueue.push(V(u.bind(null,o)))).finally(()=>{r._waitingFor===i&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(se(r,t))return r[t];const n=this.schema[t];if(!n)throw new S.NotFound("Table "+t+" not part of transaction");const a=new this.db.Table(t,n,this);return a.core=this.db.core.table(t),r[t]=a,a}}function gr(e,t,r,n,a,i,s){return{name:e,keyPath:t,unique:r,multi:n,auto:a,compound:i,src:(r&&!s?"&":"")+(n?"*":"")+(a?"++":"")+qn(t)}}function qn(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Un(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:wn(r,n=>[n.name,n])}}let lt=e=>{try{return e.only([[]]),lt=()=>[[]],[[]]}catch{return lt=()=>Ce,Ce}};function mr(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?n=>n[t]:n=>ke(n,t)}(e):t=>ke(t,e)}function an(e){return[].slice.call(e)}let qa=0;function rt(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function Ua(e,t,r){function n(o){if(o.type===3)return null;if(o.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:h,upper:l,lowerOpen:c,upperOpen:f}=o;return h===void 0?l===void 0?null:t.upperBound(l,!!f):l===void 0?t.lowerBound(h,!!c):t.bound(h,l,!!c,!!f)}const{schema:a,hasGetAll:i}=function(o,h){const l=an(o.objectStoreNames);return{schema:{name:o.name,tables:l.map(c=>h.objectStore(c)).map(c=>{const{keyPath:f,autoIncrement:p}=c,m=te(f),g=f==null,d={},v={name:c.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:m,keyPath:f,autoIncrement:p,unique:!0,extractKey:mr(f)},indexes:an(c.indexNames).map(y=>c.index(y)).map(y=>{const{name:w,unique:b,multiEntry:_,keyPath:A}=y,E={name:w,compound:te(A),keyPath:A,unique:b,multiEntry:_,extractKey:mr(A)};return d[rt(A)]=E,E}),getIndexByKeyPath:y=>d[rt(y)]};return d[":id"]=v.primaryKey,f!=null&&(d[rt(f)]=v.primaryKey),v})},hasGetAll:l.length>0&&"getAll"in h.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),s=a.tables.map(o=>function(h){const l=h.name;return{name:l,schema:h,mutate:function({trans:c,type:f,keys:p,values:m,range:g}){return new Promise((d,v)=>{d=V(d);const y=c.objectStore(l),w=y.keyPath==null,b=f==="put"||f==="add";if(!b&&f!=="delete"&&f!=="deleteRange")throw new Error("Invalid operation type: "+f);const{length:_}=p||m||{length:1};if(p&&m&&p.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(_===0)return d({numFailures:0,failures:{},results:[],lastResult:void 0});let A;const E=[],M=[];let P=0;const I=G=>{++P,ot(G)};if(f==="deleteRange"){if(g.type===4)return d({numFailures:P,failures:M,results:[],lastResult:void 0});g.type===3?E.push(A=y.clear()):E.push(A=y.delete(n(g)))}else{const[G,L]=b?w?[m,p]:[m,null]:[p,null];if(b)for(let R=0;R<_;++R)E.push(A=L&&L[R]!==void 0?y[f](G[R],L[R]):y[f](G[R])),A.onerror=I;else for(let R=0;R<_;++R)E.push(A=y[f](G[R])),A.onerror=I}const C=G=>{const L=G.target.result;E.forEach((R,X)=>R.error!=null&&(M[X]=R.error)),d({numFailures:P,failures:M,results:f==="delete"?p:E.map(R=>R.result),lastResult:L})};A.onerror=G=>{I(G),C(G)},A.onsuccess=C})},getMany:({trans:c,keys:f})=>new Promise((p,m)=>{p=V(p);const g=c.objectStore(l),d=f.length,v=new Array(d);let y,w=0,b=0;const _=E=>{const M=E.target;v[M._pos]=M.result,++b===w&&p(v)},A=de(m);for(let E=0;E<d;++E)f[E]!=null&&(y=g.get(f[E]),y._pos=E,y.onsuccess=_,y.onerror=A,++w);w===0&&p(v)}),get:({trans:c,key:f})=>new Promise((p,m)=>{p=V(p);const g=c.objectStore(l).get(f);g.onsuccess=d=>p(d.target.result),g.onerror=de(m)}),query:function(c){return f=>new Promise((p,m)=>{p=V(p);const{trans:g,values:d,limit:v,query:y}=f,w=v===1/0?void 0:v,{index:b,range:_}=y,A=g.objectStore(l),E=b.isPrimaryKey?A:A.index(b.name),M=n(_);if(v===0)return p({result:[]});if(c){const P=d?E.getAll(M,w):E.getAllKeys(M,w);P.onsuccess=I=>p({result:I.target.result}),P.onerror=de(m)}else{let P=0;const I=d||!("openKeyCursor"in E)?E.openCursor(M):E.openKeyCursor(M),C=[];I.onsuccess=G=>{const L=I.result;return L?(C.push(d?L.value:L.primaryKey),++P===v?p({result:C}):void L.continue()):p({result:C})},I.onerror=de(m)}})}(i),openCursor:function({trans:c,values:f,query:p,reverse:m,unique:g}){return new Promise((d,v)=>{d=V(d);const{index:y,range:w}=p,b=c.objectStore(l),_=y.isPrimaryKey?b:b.index(y.name),A=m?g?"prevunique":"prev":g?"nextunique":"next",E=f||!("openKeyCursor"in _)?_.openCursor(n(w),A):_.openKeyCursor(n(w),A);E.onerror=de(v),E.onsuccess=V(M=>{const P=E.result;if(!P)return void d(null);P.___id=++qa,P.done=!1;const I=P.continue.bind(P);let C=P.continuePrimaryKey;C&&(C=C.bind(P));const G=P.advance.bind(P),L=()=>{throw new Error("Cursor not stopped")};P.trans=c,P.stop=P.continue=P.continuePrimaryKey=P.advance=()=>{throw new Error("Cursor not started")},P.fail=V(v),P.next=function(){let R=1;return this.start(()=>R--?this.continue():this.stop()).then(()=>this)},P.start=R=>{const X=new Promise((B,k)=>{B=V(B),E.onerror=de(k),P.fail=k,P.stop=x=>{P.stop=P.continue=P.continuePrimaryKey=P.advance=L,B(x)}}),W=()=>{if(E.result)try{R()}catch(B){P.fail(B)}else P.done=!0,P.start=()=>{throw new Error("Cursor behind last entry")},P.stop()};return E.onsuccess=V(B=>{E.onsuccess=W,W()}),P.continue=I,P.continuePrimaryKey=C,P.advance=G,W(),X},d(P)},v)})},count({query:c,trans:f}){const{index:p,range:m}=c;return new Promise((g,d)=>{const v=f.objectStore(l),y=p.isPrimaryKey?v:v.index(p.name),w=n(m),b=w?y.count(w):y.count();b.onsuccess=V(_=>g(_.target.result)),b.onerror=de(d)})}}}(o)),u={};return s.forEach(o=>u[o.name]=o),{stack:"dbcore",transaction:e.transaction.bind(e),table(o){if(!u[o])throw new Error(`Table '${o}' not found`);return u[o]},MIN_KEY:-1/0,MAX_KEY:lt(t),schema:a}}function wr({_novip:e},t){const r=t.db,n=function(a,i,{IDBKeyRange:s,indexedDB:u},o){return{dbcore:function(l,c){return c.reduce((f,{create:p})=>({...f,...p(f)}),l)}(Ua(i,s,o),a.dbcore)}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach(a=>{const i=a.name;e.core.schema.tables.some(s=>s.name===i)&&(a.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=a.core))})}function Rt({_novip:e},t,r,n){r.forEach(a=>{const i=n[a];t.forEach(s=>{const u=Dr(s,a);(!u||"value"in u&&u.value===void 0)&&(s===e.Transaction.prototype||s instanceof e.Transaction?_e(s,a,{get(){return this.table(a)},set(o){yn(this,a,{value:o,writable:!0,configurable:!0,enumerable:!0})}}):s[a]=new e.Table(a,i))})})}function br({_novip:e},t){t.forEach(r=>{for(let n in r)r[n]instanceof e.Table&&delete r[n]})}function $a(e,t){return e._cfg.version-t._cfg.version}function za(e,t,r,n){const a=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,a);i.create(r),i._completion.catch(n);const s=i._reject.bind(i),u=T.transless||T;Me(()=>{T.trans=i,T.transless=u,t===0?(J(a).forEach(o=>{tr(r,o,a[o].primKey,a[o].indexes)}),wr(e,r),O.follow(()=>e.on.populate.fire(i)).catch(s)):function({_novip:o},h,l,c){const f=[],p=o._versions;let m=o._dbSchema=kr(o,o.idbdb,c),g=!1;const d=p.filter(y=>y._cfg.version>=h);function v(){return f.length?O.resolve(f.shift()(l.idbtrans)).then(v):O.resolve()}return d.forEach(y=>{f.push(()=>{const w=m,b=y._cfg.dbschema;Er(o,w,c),Er(o,b,c),m=o._dbSchema=b;const _=$n(w,b);_.add.forEach(E=>{tr(c,E[0],E[1].primKey,E[1].indexes)}),_.change.forEach(E=>{if(E.recreate)throw new S.Upgrade("Not yet support for changing primary key");{const M=c.objectStore(E.name);E.add.forEach(P=>_r(M,P)),E.change.forEach(P=>{M.deleteIndex(P.name),_r(M,P)}),E.del.forEach(P=>M.deleteIndex(P))}});const A=y._cfg.contentUpgrade;if(A&&y._cfg.version>h){wr(o,c),l._memoizedTables={},g=!0;let E=bn(b);_.del.forEach(C=>{E[C]=w[C]}),br(o,[o.Transaction.prototype]),Rt(o,[o.Transaction.prototype],J(E),E),l.schema=E;const M=Rr(A);let P;M&&Ve();const I=O.follow(()=>{if(P=A(l),P&&M){var C=Ee.bind(null,null);P.then(C,C)}});return P&&typeof P.then=="function"?O.resolve(P):I.then(()=>P)}}),f.push(w=>{(!g||!Ba)&&function(b,_){[].slice.call(_.db.objectStoreNames).forEach(A=>b[A]==null&&_.db.deleteObjectStore(A))}(y._cfg.dbschema,w),br(o,[o.Transaction.prototype]),Rt(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),l.schema=o._dbSchema})}),v().then(()=>{var y,w;w=c,J(y=m).forEach(b=>{w.db.objectStoreNames.contains(b)||tr(w,b,y[b].primKey,y[b].indexes)})})}(e,t,i,r).catch(s)})}function $n(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const a=e[n],i=t[n];if(a){const s={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto&&!Lt)s.recreate=!0,r.change.push(s);else{const u=a.idxByName,o=i.idxByName;let h;for(h in u)o[h]||s.del.push(h);for(h in o){const l=u[h],c=o[h];l?l.src!==c.src&&s.change.push(c):s.add.push(c)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,i])}return r}function tr(e,t,r,n){const a=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(i=>_r(a,i)),a}function _r(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function kr(e,t,r){const n={};return Tt(t.objectStoreNames,0).forEach(a=>{const i=r.objectStore(a);let s=i.keyPath;const u=gr(qn(s),s||"",!1,!1,!!i.autoIncrement,s&&typeof s!="string",!0),o=[];for(let l=0;l<i.indexNames.length;++l){const c=i.index(i.indexNames[l]);s=c.keyPath;var h=gr(c.name,s,!!c.unique,!!c.multiEntry,!1,s&&typeof s!="string",!1);o.push(h)}n[a]=Un(a,u,o)}),n}function Er({_novip:e},t,r){const n=r.db.objectStoreNames;for(let a=0;a<n.length;++a){const i=n[a],s=r.objectStore(i);e._hasGetAll="getAll"in s;for(let u=0;u<s.indexNames.length;++u){const o=s.indexNames[u],h=s.index(o).keyPath,l=typeof h=="string"?h:"["+Tt(h).join("+")+"]";if(t[i]){const c=t[i].idxByName[l];c&&(c.name=o,delete t[i].idxByName[l],t[i].idxByName[o]=c)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&z.WorkerGlobalScope&&z instanceof z.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Ga{_parseStoresSpec(t,r){J(t).forEach(n=>{if(t[n]!==null){var a=t[n].split(",").map((s,u)=>{const o=(s=s.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return gr(o,h||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),te(h),u===0)}),i=a.shift();if(i.multi)throw new S.Schema("Primary key cannot be multi-valued");a.forEach(s=>{if(s.auto)throw new S.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new S.Schema("Index must have a name and cannot be an empty string")}),r[n]=Un(n,i,a)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?ne(this._cfg.storesSource,t):t;const n=r._versions,a={};let i={};return n.forEach(s=>{ne(a,s._cfg.storesSource),i=s._cfg.dbschema={},s._parseStoresSpec(a,i)}),r._dbSchema=i,br(r,[r._allTables,r,r.Transaction.prototype]),Rt(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],J(i),i),r._storeNames=J(i),this}upgrade(t){return this._cfg.contentUpgrade=Nr(this._cfg.contentUpgrade||q,t),this}}function $r(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new je(qt,{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function zr(e){return e&&typeof e.databases=="function"}function Ar(e){return Me(function(){return T.letThrough=!0,e()})}function Va(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function Wa(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?Q(t.dbOpenError):e);pe&&(t.openCanceller._stackHolder=Ke()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function a(){if(t.openCanceller!==n)throw new S.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,s=null,u=!1;const o=()=>new O((h,l)=>{if(a(),!r)throw new S.MissingAPI;const c=e.name,f=t.autoSchema?r.open(c):r.open(c,Math.round(10*e.verno));if(!f)throw new S.MissingAPI;f.onerror=de(l),f.onblocked=V(e._fireOnBlocked),f.onupgradeneeded=V(p=>{if(s=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=ot,s.abort(),f.result.close();const g=r.deleteDatabase(c);g.onsuccess=g.onerror=V(()=>{l(new S.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{s.onerror=de(l);var m=p.oldVersion>Math.pow(2,62)?0:p.oldVersion;u=m<1,e._novip.idbdb=f.result,za(e,m/10,s,l)}},l),f.onsuccess=V(()=>{s=null;const p=e._novip.idbdb=f.result,m=Tt(p.objectStoreNames);if(m.length>0)try{const d=p.transaction((g=m).length===1?g[0]:g,"readonly");t.autoSchema?function({_novip:v},y,w){v.verno=y.version/10;const b=v._dbSchema=kr(0,y,w);v._storeNames=Tt(y.objectStoreNames,0),Rt(v,[v._allTables],J(b),b)}(e,p,d):(Er(e,e._dbSchema,d),function(v,y){const w=$n(kr(0,v.idbdb,y),v._dbSchema);return!(w.add.length||w.change.some(b=>b.add.length||b.change.length))}(e,d)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),wr(e,d)}catch{}var g;et.push(e),p.onversionchange=V(d=>{t.vcFired=!0,e.on("versionchange").fire(d)}),p.onclose=V(d=>{e.on("close").fire(d)}),u&&function({indexedDB:d,IDBKeyRange:v},y){!zr(d)&&y!==qt&&$r(d,v).put({name:y}).catch(q)}(e._deps,c),h()},l)}).catch(h=>h&&h.name==="UnknownError"&&t.PR1398_maxLoop>0?(t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),o()):O.reject(h));return O.race([n,(typeof navigator>"u"?O.resolve():Va()).then(o)]).then(()=>(a(),t.onReadyBeingFired=[],O.resolve(Ar(()=>e.on.ready.fire(e.vip))).then(function h(){if(t.onReadyBeingFired.length>0){let l=t.onReadyBeingFired.reduce(Nr,q);return t.onReadyBeingFired=[],O.resolve(Ar(()=>l(e.vip))).then(h)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(h=>{t.dbOpenError=h;try{s&&s.abort()}catch{}return n===t.openCanceller&&e._close(),Q(h)}).finally(()=>{t.openComplete=!0,i()})}function xr(e){var t=i=>e.next(i),r=a(t),n=a(i=>e.throw(i));function a(i){return s=>{var u=i(s),o=u.value;return u.done?o:o&&typeof o.then=="function"?o.then(r,n):te(o)?Promise.all(o).then(r,n):r(o)}}return a(t)()}function Ya(e,t,r){var n=arguments.length;if(n<2)throw new S.InvalidArgument("Too few arguments");for(var a=new Array(n-1);--n;)a[n-1]=arguments[n];return r=a.pop(),[e,_n(a),r]}function zn(e,t,r,n,a){return O.resolve().then(()=>{const i=T.transless||T,s=e._createTransaction(t,r,e._dbSchema,n),u={trans:s,transless:i};if(n)s.idbtrans=n.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(c){return c.name===Fr.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>zn(e,t,r,null,a))):Q(c)}const o=Rr(a);let h;o&&Ve();const l=O.follow(()=>{if(h=a.call(s,s),h)if(o){var c=Ee.bind(null,null);h.then(c,c)}else typeof h.next=="function"&&typeof h.throw=="function"&&(h=xr(h))},u);return(h&&typeof h.then=="function"?O.resolve(h).then(c=>s.active?c:Q(new S.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):l.then(()=>h)).then(c=>(n&&s._resolve(),s._completion.then(()=>c))).catch(c=>(s._reject(c),Q(c)))})}function kt(e,t,r){const n=te(e)?e.slice():[e];for(let a=0;a<r;++a)n.push(t);return n}const Ha={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,a={},i=[];function s(l,c,f){const p=rt(l),m=a[p]=a[p]||[],g=l==null?0:typeof l=="string"?1:l.length,d=c>0,v={...f,isVirtual:d,keyTail:c,keyLength:g,extractKey:mr(l),unique:!d&&f.unique};return m.push(v),v.isPrimaryKey||i.push(v),g>1&&s(g===2?l[0]:l.slice(0,g-1),c+1,f),m.sort((y,w)=>y.keyTail-w.keyTail),v}const u=s(n.primaryKey.keyPath,0,n.primaryKey);a[":id"]=[u];for(const l of n.indexes)s(l.keyPath,0,l);function o(l){const c=l.query.index;return c.isVirtual?{...l,query:{index:c,range:(f=l.query.range,p=c.keyTail,{type:f.type===1?2:f.type,lower:kt(f.lower,f.lowerOpen?e.MAX_KEY:e.MIN_KEY,p),lowerOpen:!0,upper:kt(f.upper,f.upperOpen?e.MIN_KEY:e.MAX_KEY,p),upperOpen:!0})}}:l;var f,p}return{...r,schema:{...n,primaryKey:u,indexes:i,getIndexByKeyPath:function(l){const c=a[rt(l)];return c&&c[0]}},count:l=>r.count(o(l)),query:l=>r.query(o(l)),openCursor(l){const{keyTail:c,isVirtual:f,keyLength:p}=l.query.index;return f?r.openCursor(o(l)).then(m=>m&&function(g){return Object.create(g,{continue:{value:function(v){v!=null?g.continue(kt(v,l.reverse?e.MAX_KEY:e.MIN_KEY,c)):l.unique?g.continue(g.key.slice(0,p).concat(l.reverse?e.MIN_KEY:e.MAX_KEY,c)):g.continue()}},continuePrimaryKey:{value(v,y){g.continuePrimaryKey(kt(v,e.MAX_KEY,c),y)}},primaryKey:{get:()=>g.primaryKey},key:{get(){const v=g.key;return p===1?v[0]:v.slice(0,p)}},value:{get:()=>g.value}})}(m)):r.openCursor(l)}}}}}};function Gr(e,t,r,n){return r=r||{},n=n||"",J(e).forEach(a=>{if(se(t,a)){var i=e[a],s=t[a];if(typeof i=="object"&&typeof s=="object"&&i&&s){const u=ar(i);u!==ar(s)?r[n+a]=t[a]:u==="Object"?Gr(i,s,r,n+a+"."):i!==s&&(r[n+a]=t[a])}else i!==s&&(r[n+a]=t[a])}else r[n+a]=void 0}),J(t).forEach(a=>{se(e,a)||(r[n+a]=t[a])}),r}const Ja={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema;return{...r,mutate(i){const s=T.trans,{deleting:u,creating:o,updating:h}=s.table(t).hook;switch(i.type){case"add":if(o.fire===q)break;return s._promise("readwrite",()=>l(i),!0);case"put":if(o.fire===q&&h.fire===q)break;return s._promise("readwrite",()=>l(i),!0);case"delete":if(u.fire===q)break;return s._promise("readwrite",()=>l(i),!0);case"deleteRange":if(u.fire===q)break;return s._promise("readwrite",()=>function(f){return c(f.trans,f.range,1e4)}(i),!0)}return r.mutate(i);function l(f){const p=T.trans,m=f.keys||function(g,d){return d.type==="delete"?d.keys:d.keys||d.values.map(g.extractKey)}(n,f);if(!m)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?{...f,keys:m}:{...f}).type!=="delete"&&(f.values=[...f.values]),f.keys&&(f.keys=[...f.keys]),function(g,d,v){return d.type==="add"?Promise.resolve([]):g.getMany({trans:d.trans,keys:v,cache:"immutable"})}(r,f,m).then(g=>{const d=m.map((v,y)=>{const w=g[y],b={onerror:null,onsuccess:null};if(f.type==="delete")u.fire.call(b,v,w,p);else if(f.type==="add"||w===void 0){const _=o.fire.call(b,v,f.values[y],p);v==null&&_!=null&&(v=_,f.keys[y]=v,n.outbound||he(f.values[y],n.keyPath,v))}else{const _=Gr(w,f.values[y]),A=h.fire.call(b,_,v,w,p);if(A){const E=f.values[y];Object.keys(A).forEach(M=>{se(E,M)?E[M]=A[M]:he(E,M,A[M])})}}return b});return r.mutate(f).then(({failures:v,results:y,numFailures:w,lastResult:b})=>{for(let _=0;_<m.length;++_){const A=y?y[_]:m[_],E=d[_];A==null?E.onerror&&E.onerror(v[_]):E.onsuccess&&E.onsuccess(f.type==="put"&&g[_]?f.values[_]:A)}return{failures:v,results:y,numFailures:w,lastResult:b}}).catch(v=>(d.forEach(y=>y.onerror&&y.onerror(v)),Promise.reject(v)))})}function c(f,p,m){return r.query({trans:f,values:!1,query:{index:n,range:p},limit:m}).then(({result:g})=>l({type:"delete",keys:g,trans:f}).then(d=>d.numFailures>0?Promise.reject(d.failures[0]):g.length<m?{failures:[],numFailures:0,lastResult:void 0}:c(f,{...p,lower:g[g.length-1],lowerOpen:!0},m)))}}}}})};function Gn(e,t,r){try{if(!t||t.keys.length<e.length)return null;const n=[];for(let a=0,i=0;a<t.keys.length&&i<e.length;++a)re(t.keys[a],e[i])===0&&(n.push(r?dt(t.values[a]):t.values[a]),++i);return n.length===e.length?n:null}catch{return null}}const Za={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const a=Gn(n.keys,n.trans._cache,n.cache==="clone");return a?O.resolve(a):r.getMany(n).then(i=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?dt(i):i},i))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function Vr(e){return!("from"in e)}const me=function(e,t){if(!this){const r=new me;return e&&"d"in e&&ne(r,e),r}ne(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function ct(e,t,r){const n=re(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Vr(e))return ne(e,{from:t,to:r,d:1});const a=e.l,i=e.r;if(re(r,e.from)<0)return a?ct(a,t,r):e.l={from:t,to:r,d:1,l:null,r:null},sn(e);if(re(t,e.to)>0)return i?ct(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},sn(e);re(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),re(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const s=!e.r;a&&!e.l&&Kt(e,a),i&&s&&Kt(e,i)}function Kt(e,t){Vr(t)||function r(n,{from:a,to:i,l:s,r:u}){ct(n,a,i),s&&r(n,s),u&&r(n,u)}(e,t)}function Qa(e,t){const r=Pr(t);let n=r.next();if(n.done)return!1;let a=n.value;const i=Pr(e);let s=i.next(a.from),u=s.value;for(;!n.done&&!s.done;){if(re(u.from,a.to)<=0&&re(u.to,a.from)>=0)return!0;re(a.from,u.from)<0?a=(n=r.next(u.from)).value:u=(s=i.next(a.from)).value}return!1}function Pr(e){let t=Vr(e)?null:{s:0,n:e};return{next(r){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&re(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||re(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function sn(e){var t,r;const n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),a=n>1?"r":n<-1?"l":"";if(a){const i=a==="r"?"l":"r",s={...e},u=e[a];e.from=u.from,e.to=u.to,e[a]=u[a],s[a]=u[i],e[i]=s,s.d=on(s)}e.d=on(e)}function on({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}ze(me.prototype,{add(e){return Kt(this,e),this},addKey(e){return ct(this,e,e),this},addKeys(e){return e.forEach(t=>ct(this,t,t)),this},[ir](){return Pr(this)}});const Xa={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new me(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const a=e.table(n),{schema:i}=a,{primaryKey:s}=i,{extractKey:u,outbound:o}=s,h={...a,mutate:f=>{const p=f.trans,m=p.mutatedParts||(p.mutatedParts={}),g=A=>{const E=`idb://${t}/${n}/${A}`;return m[E]||(m[E]=new me)},d=g(""),v=g(":dels"),{type:y}=f;let[w,b]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[];const _=f.trans._cache;return a.mutate(f).then(A=>{if(te(w)){y!=="delete"&&(w=A.results),d.addKeys(w);const E=Gn(w,_);E||y==="add"||v.addKeys(w),(E||b)&&function(M,P,I,C){function G(L){const R=M(L.name||"");function X(B){return B!=null?L.extractKey(B):null}const W=B=>L.multiEntry&&te(B)?B.forEach(k=>R.addKey(k)):R.addKey(B);(I||C).forEach((B,k)=>{const x=I&&X(I[k]),j=C&&X(C[k]);re(x,j)!==0&&(x!=null&&W(x),j!=null&&W(j))})}P.indexes.forEach(G)}(g,i,E,b)}else if(w){const E={from:w.lower,to:w.upper};v.add(E),d.add(E)}else d.add(r),v.add(r),i.indexes.forEach(E=>g(E.name).add(r));return A})}},l=({query:{index:f,range:p}})=>{var m,g;return[f,new me((m=p.lower)!==null&&m!==void 0?m:e.MIN_KEY,(g=p.upper)!==null&&g!==void 0?g:e.MAX_KEY)]},c={get:f=>[s,new me(f.key)],getMany:f=>[s,new me().addKeys(f.keys)],count:l,query:l,openCursor:l};return J(c).forEach(f=>{h[f]=function(p){const{subscr:m}=T;if(m){const g=b=>{const _=`idb://${t}/${n}/${b}`;return m[_]||(m[_]=new me)},d=g(""),v=g(":dels"),[y,w]=c[f](p);if(g(y.name||"").add(w),!y.isPrimaryKey){if(f!=="count"){const b=f==="query"&&o&&p.values&&a.query({...p,values:!1});return a[f].apply(this,arguments).then(_=>{if(f==="query"){if(o&&p.values)return b.then(({result:E})=>(d.addKeys(E),_));const A=p.values?_.result.map(u):_.result;p.values?d.addKeys(A):v.addKeys(A)}else if(f==="openCursor"){const A=_,E=p.values;return A&&Object.create(A,{key:{get:()=>(v.addKey(A.primaryKey),A.key)},primaryKey:{get(){const M=A.primaryKey;return v.addKey(M),M}},value:{get:()=>(E&&d.addKey(A.primaryKey),A.value)}})}return _})}v.add(r)}}return a[f].apply(this,arguments)}}),h}}}};class je{constructor(t,r){this._middlewares={},this.verno=0;const n=je.dependencies;this._options=r={addons:je.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:a}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:q,dbReadyPromise:null,cancelOpen:q,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;i.dbReadyPromise=new O(u=>{i.dbReadyResolve=u}),i.openCanceller=new O((u,o)=>{i.cancelOpen=o}),this._state=i,this.name=t,this.on=tt(this,"populate","blocked","versionchange","close",{ready:[Nr,q]}),this.on.ready.subscribe=gn(this.on.ready.subscribe,u=>(o,h)=>{je.vip(()=>{const l=this._state;if(l.openComplete)l.dbOpenError||O.resolve().then(o),h&&u(o);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(o),h&&u(o);else{u(o);const c=this;h||u(function f(){c.on.ready.unsubscribe(o),c.on.ready.unsubscribe(f)})}})}),this.Collection=(s=this,He(Ra.prototype,function(u,o){this.db=s;let h=Fn,l=null;if(o)try{h=o()}catch(m){l=m}const c=u._ctx,f=c.table,p=f.hook.reading.fire;this._ctx={table:f,index:c.index,isPrimKey:!c.index||f.schema.primKey.keyPath&&c.index===f.schema.primKey.name,range:h,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:l,or:c.or,valueMapper:p!==it?p:null}})),this.Table=function(u){return He(Da.prototype,function(o,h,l){this.db=u,this._tx=l,this.name=o,this.schema=h,this.hook=u._allTables[o]?u._allTables[o].hook:tt(null,{creating:[Ea,q],reading:[ka,it],updating:[xa,q],deleting:[Aa,q]})})}(this),this.Transaction=function(u){return He(La.prototype,function(o,h,l,c,f){this.db=u,this.mode=o,this.storeNames=h,this.schema=l,this.chromeTransactionDurability=c,this.idbtrans=null,this.on=tt(this,"complete","error","abort"),this.parent=f||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new O((p,m)=>{this._resolve=p,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},p=>{var m=this.active;return this.active=!1,this.on.error.fire(p),this.parent?this.parent._reject(p):m&&this.idbtrans&&this.idbtrans.abort(),Q(p)})})}(this),this.Version=function(u){return He(Ga.prototype,function(o){this.db=u,this._cfg={version:o,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(u){return He(Ln.prototype,function(o,h,l){this.db=u,this._ctx={table:o,index:h===":id"?null:h,or:l};const c=u._deps.indexedDB;if(!c)throw new S.MissingAPI;this._cmp=this._ascending=c.cmp.bind(c),this._descending=(f,p)=>c.cmp(p,f),this._max=(f,p)=>c.cmp(f,p)>0?f:p,this._min=(f,p)=>c.cmp(f,p)<0?f:p,this._IDBKeyRange=u._deps.IDBKeyRange})}(this),this.on("versionchange",u=>{u.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",u=>{!u.newVersion||u.newVersion<u.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${u.oldVersion/10}`)}),this._maxKey=lt(r.IDBKeyRange),this._createTransaction=(u,o,h,l)=>new this.Transaction(u,o,h,this._options.chromeTransactionDurability,l),this._fireOnBlocked=u=>{this.on("blocked").fire(u),et.filter(o=>o.name===this.name&&o!==this&&!o._state.vcFired).map(o=>o.on("versionchange").fire(u))},this.use(Ha),this.use(Ja),this.use(Xa),this.use(Za),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(u=>u(this))}version(t){if(isNaN(t)||t<.1)throw new S.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var n=r.filter(a=>a._cfg.version===t)[0];return n||(n=new this.Version(t),r.push(n),r.sort($a),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||T.letThrough||this._vip)?t():new O((r,n)=>{if(this._state.openComplete)return n(new S.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new S.DatabaseClosed);this.open().catch(q)}this._state.dbReadyPromise.then(r,n)}).then(t)}use({stack:t,create:r,level:n,name:a}){a&&this.unuse({stack:t,name:a});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:r,level:n??10,name:a}),i.sort((s,u)=>s.level-u.level),this}unuse({stack:t,name:r,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(a=>n?a.create!==n:!!r&&a.name!==r)),this}open(){return Wa(this)}_close(){const t=this._state,r=et.indexOf(this);if(r>=0&&et.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new O(n=>{t.dbReadyResolve=n}),t.openCanceller=new O((n,a)=>{t.cancelOpen=a})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new S.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new O((n,a)=>{const i=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=V(()=>{(function({indexedDB:u,IDBKeyRange:o},h){!zr(u)&&h!==qt&&$r(u,o).delete(h).catch(q)})(this._deps,this.name),n()}),s.onerror=de(a),s.onblocked=this._fireOnBlocked};if(t)throw new S.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return J(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Ya.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,n){let a=T.trans;a&&a.db===this&&t.indexOf("!")===-1||(a=null);const i=t.indexOf("?")!==-1;let s,u;t=t.replace("!","").replace("?","");try{if(u=r.map(h=>{var l=h instanceof this.Table?h.name:h;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),t=="r"||t===Jt)s=Jt;else{if(t!="rw"&&t!=Zt)throw new S.InvalidArgument("Invalid transaction mode: "+t);s=Zt}if(a){if(a.mode===Jt&&s===Zt){if(!i)throw new S.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&u.forEach(h=>{if(a&&a.storeNames.indexOf(h)===-1){if(!i)throw new S.SubTransaction("Table "+h+" not included in parent transaction.");a=null}}),i&&a&&!a.active&&(a=null)}}catch(h){return a?a._promise(null,(l,c)=>{c(h)}):Q(h)}const o=zn.bind(null,this,s,u,a,n);return a?a._promise(s,o,"lock"):T.trans?We(T.transless,()=>this._whenReady(o)):this._whenReady(o)}table(t){if(!se(this._allTables,t))throw new S.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const ei=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ti{constructor(t){this._subscribe=t}subscribe(t,r,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:n})}[ei](){return this}}function Vn(e,t){return J(t).forEach(r=>{Kt(e[r]||(e[r]=new me),t[r])}),e}function ri(e){let t,r=!1;const n=new ti(a=>{const i=Rr(e);let s=!1,u={},o={};const h={get closed(){return s},unsubscribe:()=>{s=!0,Te.storagemutated.unsubscribe(p)}};a.start&&a.start(h);let l=!1,c=!1;function f(){return J(o).some(g=>u[g]&&Qa(u[g],o[g]))}const p=g=>{Vn(u,g),f()&&m()},m=()=>{if(l||s)return;u={};const g={},d=function(v){i&&Ve();const y=()=>Me(e,{subscr:v,trans:null}),w=T.trans?We(T.transless,y):y();return i&&w.then(Ee,Ee),w}(g);c||(Te(ut,p),c=!0),l=!0,Promise.resolve(d).then(v=>{r=!0,t=v,l=!1,s||(f()?m():(u={},o=g,a.next&&a.next(v)))},v=>{l=!1,r=!1,a.error&&a.error(v),h.unsubscribe()})};return m(),h});return n.hasValue=()=>r,n.getValue=()=>t,n}let jr;try{jr={indexedDB:z.indexedDB||z.mozIndexedDB||z.webkitIndexedDB||z.msIndexedDB,IDBKeyRange:z.IDBKeyRange||z.webkitIDBKeyRange}}catch{jr={indexedDB:null,IDBKeyRange:null}}const Se=je;function Ot(e){let t=be;try{be=!0,Te.storagemutated.fire(e)}finally{be=t}}ze(Se,{...Et,delete:e=>new Se(e,{addons:[]}).delete(),exists:e=>new Se(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:r}){return zr(t)?Promise.resolve(t.databases()).then(n=>n.map(a=>a.name).filter(a=>a!==qt)):$r(t,r).toCollection().primaryKeys()}(Se.dependencies).then(e)}catch{return Q(new S.MissingAPI)}},defineClass:()=>function(e){ne(this,e)},ignoreTransaction:e=>T.trans?We(T.transless,e):e(),vip:Ar,async:function(e){return function(){try{var t=xr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:O.resolve(t)}catch(r){return Q(r)}}},spawn:function(e,t,r){try{var n=xr(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:O.resolve(n)}catch(a){return Q(a)}},currentTransaction:{get:()=>T.trans||null},waitFor:function(e,t){const r=O.resolve(typeof e=="function"?Se.ignoreTransaction(e):e).timeout(t||6e4);return T.trans?T.trans.waitFor(r):r},Promise:O,debug:{get:()=>pe,set:e=>{En(e,e==="dexie"?()=>!0:Kn)}},derive:qe,extend:ne,props:ze,override:gn,Events:tt,on:Te,liveQuery:ri,extendObservabilitySet:Vn,getByKeyPath:ke,setByKeyPath:he,delByKeyPath:function(e,t){typeof t=="string"?he(e,t,void 0):"length"in t&&[].map.call(t,function(r){he(e,r,void 0)})},shallowClone:bn,deepClone:dt,getObjectDiff:Gr,cmp:re,asap:mn,minKey:yr,addons:[],connections:et,errnames:Fr,dependencies:jr,semVer:Xr,version:Xr.split(".").map(e=>parseInt(e)).reduce((e,t,r)=>e+t/Math.pow(10,2*r))}),Se.maxKey=lt(Se.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Te(ut,e=>{if(!be){let t;Lt?(t=document.createEvent("CustomEvent"),t.initCustomEvent(Pe,!0,!0,e)):t=new CustomEvent(Pe,{detail:e}),be=!0,dispatchEvent(t),be=!1}}),addEventListener(Pe,({detail:e})=>{be||Ot(e)}));let be=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(Pe);typeof e.unref=="function"&&e.unref(),Te(ut,t=>{be||e.postMessage(t)}),e.onmessage=t=>{t.data&&Ot(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Te(ut,t=>{try{be||(typeof localStorage<"u"&&localStorage.setItem(Pe,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:Pe,changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key===Pe){const r=JSON.parse(t.newValue);r&&Ot(r.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type===Pe&&Ot(t.changedParts)})}O.rejectionMapper=function(e,t){if(!e||e instanceof Ue||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Hr[e.name])return e;var r=new Hr[e.name](t||e.message,e);return"stack"in e&&_e(r,"stack",{get:function(){return this.inner.stack}}),r},En(pe,Kn);var ae=63710088e-1,Wn={centimeters:ae*100,centimetres:ae*100,degrees:ae/111325,feet:ae*3.28084,inches:ae*39.37,kilometers:ae/1e3,kilometres:ae/1e3,meters:ae,metres:ae,miles:ae/1609.344,millimeters:ae*1e3,millimetres:ae*1e3,nauticalmiles:ae/1852,radians:1,yards:ae*1.0936};function Ft(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function Mr(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!un(e[0])||!un(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Ft(n,t,r)}function ni(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Ft(n,t,r)}function ai(e,t){t===void 0&&(t="kilometers");var r=Wn[t];if(!r)throw new Error(t+" units is invalid");return e*r}function ii(e,t){t===void 0&&(t="kilometers");var r=Wn[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Or(e){var t=e%(2*Math.PI);return t*180/Math.PI}function ce(e){var t=e%360;return t*Math.PI/180}function un(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ht(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function si(e){return e.type==="Feature"?e.geometry:e}function Yn(e,t,r){if(r===void 0&&(r={}),r.final===!0)return oi(e,t);var n=ht(e),a=ht(t),i=ce(n[0]),s=ce(a[0]),u=ce(n[1]),o=ce(a[1]),h=Math.sin(s-i)*Math.cos(o),l=Math.cos(u)*Math.sin(o)-Math.sin(u)*Math.cos(o)*Math.cos(s-i);return Or(Math.atan2(h,l))}function oi(e,t){var r=Yn(t,e);return r=(r+180)%360,r}function ui(e,t,r,n){n===void 0&&(n={});var a=ht(e),i=ce(a[0]),s=ce(a[1]),u=ce(r),o=ii(t,n.units),h=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(u)),l=i+Math.atan2(Math.sin(u)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(h)),c=Or(l),f=Or(h);return Mr([c,f],n.properties)}function Hn(e,t,r){r===void 0&&(r={});var n=ht(e),a=ht(t),i=ce(a[1]-n[1]),s=ce(a[0]-n[0]),u=ce(n[1]),o=ce(a[1]),h=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(o);return ai(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r.units)}function li(e,t,r){r===void 0&&(r={});for(var n=si(e),a=n.coordinates,i=0,s=0;s<a.length&&!(t>=i&&s===a.length-1);s++)if(i>=t){var u=t-i;if(u){var o=Yn(a[s],a[s-1])-180,h=ui(a[s],u,o,r);return h}else return Mr(a[s])}else i+=Hn(a[s],a[s+1],r);return Mr(a[a.length-1])}function Jn(e,t,r){if(e!==null)for(var n,a,i,s,u,o,h,l=0,c=0,f,p=e.type,m=p==="FeatureCollection",g=p==="Feature",d=m?e.features.length:1,v=0;v<d;v++){h=m?e.features[v].geometry:g?e.geometry:e,f=h?h.type==="GeometryCollection":!1,u=f?h.geometries.length:1;for(var y=0;y<u;y++){var w=0,b=0;if(s=f?h.geometries[y]:h,s!==null){o=s.coordinates;var _=s.type;switch(l=r&&(_==="Polygon"||_==="MultiPolygon")?1:0,_){case null:break;case"Point":if(t(o,c,v,w,b)===!1)return!1;c++,w++;break;case"LineString":case"MultiPoint":for(n=0;n<o.length;n++){if(t(o[n],c,v,w,b)===!1)return!1;c++,_==="MultiPoint"&&w++}_==="LineString"&&w++;break;case"Polygon":case"MultiLineString":for(n=0;n<o.length;n++){for(a=0;a<o[n].length-l;a++){if(t(o[n][a],c,v,w,b)===!1)return!1;c++}_==="MultiLineString"&&w++,_==="Polygon"&&b++}_==="Polygon"&&w++;break;case"MultiPolygon":for(n=0;n<o.length;n++){for(b=0,a=0;a<o[n].length;a++){for(i=0;i<o[n][a].length-l;i++){if(t(o[n][a][i],c,v,w,b)===!1)return!1;c++}b++}w++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(Jn(s.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ci(e,t){var r,n,a,i,s,u,o,h,l,c,f=0,p=e.type==="FeatureCollection",m=e.type==="Feature",g=p?e.features.length:1;for(r=0;r<g;r++){for(u=p?e.features[r].geometry:m?e.geometry:e,h=p?e.features[r].properties:m?e.properties:{},l=p?e.features[r].bbox:m?e.bbox:void 0,c=p?e.features[r].id:m?e.id:void 0,o=u?u.type==="GeometryCollection":!1,s=o?u.geometries.length:1,a=0;a<s;a++){if(i=o?u.geometries[a]:u,i===null){if(t(null,f,h,l,c)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(i,f,h,l,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<i.geometries.length;n++)if(t(i.geometries[n],f,h,l,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}f++}}function hi(e,t){ci(e,function(r,n,a,i,s){var u=r===null?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(Ft(r,a,{bbox:i,id:s}),n,0)===!1?!1:void 0}var o;switch(u){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon";break}for(var h=0;h<r.coordinates.length;h++){var l=r.coordinates[h],c={type:o,coordinates:l};if(t(Ft(c,a),n,h)===!1)return!1}})}function fi(e,t){hi(e,function(r,n,a){var i=0;if(r.geometry){var s=r.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var u,o=0,h=0,l=0;if(Jn(r,function(c,f,p,m,g){if(u===void 0||n>o||m>h||g>l){u=c,o=n,h=m,l=g,i=0;return}var d=ni([u,c],r.properties);if(t(d,n,a,g,i)===!1)return!1;i++,u=c})===!1)return!1}}})}function di(e,t,r){var n=r,a=!1;return fi(e,function(i,s,u,o,h){a===!1&&r===void 0?n=i:n=t(n,i,s,u,o,h),a=!0}),n}function ln(e,t){return t===void 0&&(t={}),di(e,function(r,n){var a=n.geometry.coordinates;return r+Hn(a[0],a[1],t)},0)}var Zn={exports:{}};(function(e,t){var r=function(){var n={},a=Math.PI/180,i=180/Math.PI,s=6378137,u=20037508342789244e-9;function o(l){return Number(l)===l&&l%1!==0}function h(l){if(l=l||{},this.size=l.size||256,this.expansion=l.antimeridian===!0?2:1,!n[this.size]){var c=this.size,f=n[this.size]={};f.Bc=[],f.Cc=[],f.zc=[],f.Ac=[];for(var p=0;p<30;p++)f.Bc.push(c/360),f.Cc.push(c/(2*Math.PI)),f.zc.push(c/2),f.Ac.push(c),c*=2}this.Bc=n[this.size].Bc,this.Cc=n[this.size].Cc,this.zc=n[this.size].zc,this.Ac=n[this.size].Ac}return h.prototype.px=function(l,c){if(o(c)){var f=this.size*Math.pow(2,c),p=f/2,m=f/360,g=f/(2*Math.PI),d=f,v=Math.min(Math.max(Math.sin(a*l[1]),-.9999),.9999),y=p+l[0]*m,w=p+.5*Math.log((1+v)/(1-v))*-g;return y>d*this.expansion&&(y=d*this.expansion),w>d&&(w=d),[y,w]}else{var p=this.zc[c],v=Math.min(Math.max(Math.sin(a*l[1]),-.9999),.9999),y=Math.round(p+l[0]*this.Bc[c]),w=Math.round(p+.5*Math.log((1+v)/(1-v))*-this.Cc[c]);return y>this.Ac[c]*this.expansion&&(y=this.Ac[c]*this.expansion),w>this.Ac[c]&&(w=this.Ac[c]),[y,w]}},h.prototype.ll=function(l,c){if(o(c)){var f=this.size*Math.pow(2,c),p=f/360,m=f/(2*Math.PI),g=f/2,d=(l[1]-g)/-m,v=(l[0]-g)/p,y=i*(2*Math.atan(Math.exp(d))-.5*Math.PI);return[v,y]}else{var d=(l[1]-this.zc[c])/-this.Cc[c],v=(l[0]-this.zc[c])/this.Bc[c],y=i*(2*Math.atan(Math.exp(d))-.5*Math.PI);return[v,y]}},h.prototype.bbox=function(l,c,f,p,m){p&&(c=Math.pow(2,f)-1-c);var g=[l*this.size,(+c+1)*this.size],d=[(+l+1)*this.size,c*this.size],v=this.ll(g,f).concat(this.ll(d,f));return m==="900913"?this.convert(v,"900913"):v},h.prototype.xyz=function(l,c,f,p){p==="900913"&&(l=this.convert(l,"WGS84"));var m=[l[0],l[1]],g=[l[2],l[3]],d=this.px(m,c),v=this.px(g,c),y=[Math.floor(d[0]/this.size),Math.floor((v[0]-1)/this.size)],w=[Math.floor(v[1]/this.size),Math.floor((d[1]-1)/this.size)],b={minX:Math.min.apply(Math,y)<0?0:Math.min.apply(Math,y),minY:Math.min.apply(Math,w)<0?0:Math.min.apply(Math,w),maxX:Math.max.apply(Math,y),maxY:Math.max.apply(Math,w)};if(f){var _={minY:Math.pow(2,c)-1-b.maxY,maxY:Math.pow(2,c)-1-b.minY};b.minY=_.minY,b.maxY=_.maxY}return b},h.prototype.convert=function(l,c){return c==="900913"?this.forward(l.slice(0,2)).concat(this.forward(l.slice(2,4))):this.inverse(l.slice(0,2)).concat(this.inverse(l.slice(2,4)))},h.prototype.forward=function(l){var c=[s*l[0]*a,s*Math.log(Math.tan(Math.PI*.25+.5*l[1]*a))];return c[0]>u&&(c[0]=u),c[0]<-u&&(c[0]=-u),c[1]>u&&(c[1]=u),c[1]<-u&&(c[1]=-u),c},h.prototype.inverse=function(l){return[l[0]*i/s,(Math.PI*.5-2*Math.atan(Math.exp(-l[1]/s)))*i]},h}();e.exports=r})(Zn);var pi=Zn.exports;const vi=vn(pi);var Ut={},yi=Math.PI/180,gi=180/Math.PI;function Qn(e){var t=cn(e[0]+1,e[2]),r=cn(e[0],e[2]),n=hn(e[1]+1,e[2]),a=hn(e[1],e[2]);return[r,n,t,a]}function mi(e){var t=Qn(e),r={type:"Polygon",coordinates:[[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]]};return r}function cn(e,t){return e/Math.pow(2,t)*360-180}function hn(e,t){var r=Math.PI-2*Math.PI*e/Math.pow(2,t);return gi*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}function Tr(e,t,r){var n=aa(e,t,r);return n[0]=Math.floor(n[0]),n[1]=Math.floor(n[1]),n}function Xn(e){return[[e[0]*2,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2,e[2]+1],[e[0]*2+1,e[1]*2+1,e[2]+1],[e[0]*2,e[1]*2+1,e[2]+1]]}function ea(e){return[e[0]>>1,e[1]>>1,e[2]-1]}function ta(e){return Xn(ea(e))}function wi(e,t){for(var r=ta(e),n=0;n<r.length;n++)if(!ra(t,r[n]))return!1;return!0}function ra(e,t){for(var r=0;r<e.length;r++)if(na(e[r],t))return!0;return!1}function na(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function bi(e){for(var t="",r=e[2];r>0;r--){var n=0,a=1<<r-1;e[0]&a&&n++,e[1]&a&&(n+=2),t+=n.toString()}return t}function _i(e){for(var t=0,r=0,n=e.length,a=n;a>0;a--){var i=1<<a-1,s=+e[n-a];s===1&&(t|=i),s===2&&(r|=i),s===3&&(t|=i,r|=i)}return[t,r,n]}function ki(e){var t=Tr(e[0],e[1],32),r=Tr(e[2],e[3],32),n=[t[0],t[1],r[0],r[1]],a=Ei(n);if(a===0)return[0,0,0];var i=n[0]>>>32-a,s=n[1]>>>32-a;return[i,s,a]}function Ei(e){for(var t=28,r=0;r<t;r++){var n=1<<32-(r+1);if((e[0]&n)!==(e[2]&n)||(e[1]&n)!==(e[3]&n))return r}return t}function aa(e,t,r){var n=Math.sin(t*yi),a=Math.pow(2,r),i=a*(e/360+.5),s=a*(.5-.25*Math.log((1+n)/(1-n))/Math.PI);return i=i%a,i<0&&(i=i+a),[i,s,r]}var Ai={tileToGeoJSON:mi,tileToBBOX:Qn,getChildren:Xn,getParent:ea,getSiblings:ta,hasTile:ra,hasSiblings:wi,tilesEqual:na,tileToQuadkey:bi,quadkeyToTile:_i,pointToTile:Tr,bboxToTile:ki,pointToTileFraction:aa},Ge=Ai;Ut.geojson=function(e,t){return{type:"FeatureCollection",features:Wr(e,t).map(xi)}};function xi(e){return{type:"Feature",geometry:Ge.tileToGeoJSON(e),properties:{}}}Ut.tiles=Wr;Ut.indexes=function(e,t){return Wr(e,t).map(Ge.tileToQuadkey)};function Wr(e,t){var r,n,a=e.coordinates,i=t.max_zoom,s={},u=[];if(e.type==="Point")return[Ge.pointToTile(a[0],a[1],i)];if(e.type==="MultiPoint")for(r=0;r<a.length;r++)n=Ge.pointToTile(a[r][0],a[r][1],i),s[le(n[0],n[1],n[2])]=!0;else if(e.type==="LineString")Sr(s,a,i);else if(e.type==="MultiLineString")for(r=0;r<a.length;r++)Sr(s,a[r],i);else if(e.type==="Polygon")fn(s,u,a,i);else if(e.type==="MultiPolygon")for(r=0;r<a.length;r++)fn(s,u,a[r],i);else throw new Error("Geometry type not implemented");if(t.min_zoom!==i){var o=u.length;for(dn(s,u),r=0;r<o;r++){var h=u[r];s[le(h[0],h[1],h[2])]=!0}return Pi(s,u,t)}return dn(s,u),u}function Pi(e,t,r){for(var n=[],a=r.max_zoom;a>r.min_zoom;a--){for(var i={},s=[],u=0;u<t.length;u++){var o=t[u];if(o[0]%2===0&&o[1]%2===0){var h=le(o[0]+1,o[1],a),l=le(o[0],o[1]+1,a),c=le(o[0]+1,o[1]+1,a);if(e[h]&&e[l]&&e[c]){e[le(o[0],o[1],o[2])]=!1,e[h]=!1,e[l]=!1,e[c]=!1;var f=[o[0]/2,o[1]/2,a-1];a-1===r.min_zoom?n.push(f):(i[le(o[0]/2,o[1]/2,a-1)]=!0,s.push(f))}}}for(u=0;u<t.length;u++)o=t[u],e[le(o[0],o[1],o[2])]&&n.push(o);e=i,t=s}return n}function fn(e,t,r,n){for(var a=[],i=0;i<r.length;i++){var s=[];Sr(e,r[i],n,s);for(var u=0,o=s.length,h=o-1;u<o;h=u++){var l=(u+1)%o,c=s[u][1];(c>s[h][1]||c>s[l][1])&&(c<s[h][1]||c<s[l][1])&&c!==s[l][1]&&a.push(s[u])}}for(a.sort(ji),i=0;i<a.length;i+=2){c=a[i][1];for(var f=a[i][0]+1;f<a[i+1][0];f++){var p=le(f,c,n);e[p]||t.push([f,c,n])}}}function ji(e,t){return e[1]-t[1]||e[0]-t[0]}function Sr(e,t,r,n){for(var a,i,s=0;s<t.length-1;s++){var u=Ge.pointToTileFraction(t[s][0],t[s][1],r),o=Ge.pointToTileFraction(t[s+1][0],t[s+1][1],r),h=u[0],l=u[1],c=o[0],f=o[1],p=c-h,m=f-l;if(!(m===0&&p===0)){var g=p>0?1:-1,d=m>0?1:-1,v=Math.floor(h),y=Math.floor(l),w=p===0?1/0:Math.abs(((p>0?1:0)+v-h)/p),b=m===0?1/0:Math.abs(((m>0?1:0)+y-l)/m),_=Math.abs(g/p),A=Math.abs(d/m);for((v!==a||y!==i)&&(e[le(v,y,r)]=!0,n&&y!==i&&n.push([v,y]),a=v,i=y);w<1||b<1;)w<b?(w+=_,v+=g):(b+=A,y+=d),e[le(v,y,r)]=!0,n&&y!==i&&n.push([v,y]),a=v,i=y}}n&&y===n[0][1]&&n.pop()}function dn(e,t){for(var r=Object.keys(e),n=0;n<r.length;n++)t.push(Mi(+r[n]))}function le(e,t,r){var n=2*(1<<r);return(n*t+e)*32+r}function Mi(e){var t=e%32,r=2*(1<<t),n=(e-t)/32,a=n%r,i=(n-a)/r%r;return[a,i,t]}var ft={exports:{}},ia={},Oi=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"},Cr={exports:{}};typeof Object.create=="function"?Cr.exports=function(t,r){t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:Cr.exports=function(t,r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t};var Ti=Cr.exports;(function(e){var t={},r=/%[sdj%]/g;e.format=function(k){if(!b(k)){for(var x=[],j=0;j<arguments.length;j++)x.push(i(arguments[j]));return x.join(" ")}for(var j=1,K=arguments,U=K.length,F=String(k).replace(r,function(N){if(N==="%%")return"%";if(j>=U)return N;switch(N){case"%s":return String(K[j++]);case"%d":return Number(K[j++]);case"%j":try{return JSON.stringify(K[j++])}catch{return"[Circular]"}default:return N}}),D=K[j];j<U;D=K[++j])v(D)||!M(D)?F+=" "+D:F+=" "+i(D);return F},e.deprecate=function(k,x){if(A(globalThis.process))return function(){return e.deprecate(k,x).apply(this,arguments)};if(process.noDeprecation===!0)return k;var j=!1;function K(){if(!j){if(process.throwDeprecation)throw new Error(x);process.traceDeprecation?console.trace(x):console.error(x),j=!0}return k.apply(this,arguments)}return K};var n={},a;e.debuglog=function(k){if(A(a)&&(a=t.NODE_DEBUG||""),k=k.toUpperCase(),!n[k])if(new RegExp("\\b"+k+"\\b","i").test(a)){var x=process.pid;n[k]=function(){var j=e.format.apply(e,arguments);console.error("%s %d: %s",k,x,j)}}else n[k]=function(){};return n[k]};function i(k,x){var j={seen:[],stylize:u};return arguments.length>=3&&(j.depth=arguments[2]),arguments.length>=4&&(j.colors=arguments[3]),d(x)?j.showHidden=x:x&&e._extend(j,x),A(j.showHidden)&&(j.showHidden=!1),A(j.depth)&&(j.depth=2),A(j.colors)&&(j.colors=!1),A(j.customInspect)&&(j.customInspect=!0),j.colors&&(j.stylize=s),h(j,k,j.depth)}e.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function s(k,x){var j=i.styles[x];return j?"\x1B["+i.colors[j][0]+"m"+k+"\x1B["+i.colors[j][1]+"m":k}function u(k,x){return k}function o(k){var x={};return k.forEach(function(j,K){x[j]=!0}),x}function h(k,x,j){if(k.customInspect&&x&&C(x.inspect)&&x.inspect!==e.inspect&&!(x.constructor&&x.constructor.prototype===x)){var K=x.inspect(j,k);return b(K)||(K=h(k,K,j)),K}var U=l(k,x);if(U)return U;var F=Object.keys(x),D=o(F);if(k.showHidden&&(F=Object.getOwnPropertyNames(x)),I(x)&&(F.indexOf("message")>=0||F.indexOf("description")>=0))return c(x);if(F.length===0){if(C(x)){var N=x.name?": "+x.name:"";return k.stylize("[Function"+N+"]","special")}if(E(x))return k.stylize(RegExp.prototype.toString.call(x),"regexp");if(P(x))return k.stylize(Date.prototype.toString.call(x),"date");if(I(x))return c(x)}var Y="",$=!1,oe=["{","}"];if(g(x)&&($=!0,oe=["[","]"]),C(x)){var ve=x.name?": "+x.name:"";Y=" [Function"+ve+"]"}if(E(x)&&(Y=" "+RegExp.prototype.toString.call(x)),P(x)&&(Y=" "+Date.prototype.toUTCString.call(x)),I(x)&&(Y=" "+c(x)),F.length===0&&(!$||x.length==0))return oe[0]+Y+oe[1];if(j<0)return E(x)?k.stylize(RegExp.prototype.toString.call(x),"regexp"):k.stylize("[Object]","special");k.seen.push(x);var ue;return $?ue=f(k,x,j,D,F):ue=F.map(function(Ye){return p(k,x,j,D,Ye,$)}),k.seen.pop(),m(ue,Y,oe)}function l(k,x){if(A(x))return k.stylize("undefined","undefined");if(b(x)){var j="'"+JSON.stringify(x).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return k.stylize(j,"string")}if(w(x))return k.stylize(""+x,"number");if(d(x))return k.stylize(""+x,"boolean");if(v(x))return k.stylize("null","null")}function c(k){return"["+Error.prototype.toString.call(k)+"]"}function f(k,x,j,K,U){for(var F=[],D=0,N=x.length;D<N;++D)B(x,String(D))?F.push(p(k,x,j,K,String(D),!0)):F.push("");return U.forEach(function(Y){Y.match(/^\d+$/)||F.push(p(k,x,j,K,Y,!0))}),F}function p(k,x,j,K,U,F){var D,N,Y;if(Y=Object.getOwnPropertyDescriptor(x,U)||{value:x[U]},Y.get?Y.set?N=k.stylize("[Getter/Setter]","special"):N=k.stylize("[Getter]","special"):Y.set&&(N=k.stylize("[Setter]","special")),B(K,U)||(D="["+U+"]"),N||(k.seen.indexOf(Y.value)<0?(v(j)?N=h(k,Y.value,null):N=h(k,Y.value,j-1),N.indexOf(`
`)>-1&&(F?N=N.split(`
`).map(function($){return"  "+$}).join(`
`).substr(2):N=`
`+N.split(`
`).map(function($){return"   "+$}).join(`
`))):N=k.stylize("[Circular]","special")),A(D)){if(F&&U.match(/^\d+$/))return N;D=JSON.stringify(""+U),D.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(D=D.substr(1,D.length-2),D=k.stylize(D,"name")):(D=D.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),D=k.stylize(D,"string"))}return D+": "+N}function m(k,x,j){var K=k.reduce(function(U,F){return F.indexOf(`
`)>=0,U+F.replace(/\u001b\[\d\d?m/g,"").length+1},0);return K>60?j[0]+(x===""?"":x+`
 `)+" "+k.join(`,
  `)+" "+j[1]:j[0]+x+" "+k.join(", ")+" "+j[1]}function g(k){return Array.isArray(k)}e.isArray=g;function d(k){return typeof k=="boolean"}e.isBoolean=d;function v(k){return k===null}e.isNull=v;function y(k){return k==null}e.isNullOrUndefined=y;function w(k){return typeof k=="number"}e.isNumber=w;function b(k){return typeof k=="string"}e.isString=b;function _(k){return typeof k=="symbol"}e.isSymbol=_;function A(k){return k===void 0}e.isUndefined=A;function E(k){return M(k)&&L(k)==="[object RegExp]"}e.isRegExp=E;function M(k){return typeof k=="object"&&k!==null}e.isObject=M;function P(k){return M(k)&&L(k)==="[object Date]"}e.isDate=P;function I(k){return M(k)&&(L(k)==="[object Error]"||k instanceof Error)}e.isError=I;function C(k){return typeof k=="function"}e.isFunction=C;function G(k){return k===null||typeof k=="boolean"||typeof k=="number"||typeof k=="string"||typeof k=="symbol"||typeof k>"u"}e.isPrimitive=G,e.isBuffer=Oi;function L(k){return Object.prototype.toString.call(k)}function R(k){return k<10?"0"+k.toString(10):k.toString(10)}var X=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function W(){var k=new Date,x=[R(k.getHours()),R(k.getMinutes()),R(k.getSeconds())].join(":");return[k.getDate(),X[k.getMonth()],x].join(" ")}e.log=function(){console.log("%s - %s",W(),e.format.apply(e,arguments))},e.inherits=Ti,e._extend=function(k,x){if(!x||!M(x))return k;for(var j=Object.keys(x),K=j.length;K--;)k[j[K]]=x[j[K]];return k};function B(k,x){return Object.prototype.hasOwnProperty.call(k,x)}})(ia);var Si={},Ci=process.platform==="win32",fe=ia;function $t(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];!a||a==="."||(a===".."?r.length&&r[r.length-1]!==".."?r.pop():t&&r.push(".."):r.push(a))}return r}function nt(e){for(var t=e.length-1,r=0;r<=t&&!e[r];r++);for(var n=t;n>=0&&!e[n];n--);return r===0&&n===t?e:r>n?[]:e.slice(r,n+1)}var sa=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,Bi=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,H={};function zt(e){var t=sa.exec(e),r=(t[1]||"")+(t[2]||""),n=t[3]||"",a=Bi.exec(n),i=a[1],s=a[2],u=a[3];return[r,i,s,u]}function Yr(e){var t=sa.exec(e),r=t[1]||"",n=!!r&&r[1]!==":";return{device:r,isUnc:n,isAbsolute:n||!!t[2],tail:t[3]}}function oa(e){return"\\\\"+e.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}H.resolve=function(){for(var e="",t="",r=!1,n=arguments.length-1;n>=-1;n--){var a;if(n>=0?a=arguments[n]:e?(a=Si["="+e],(!a||a.substr(0,3).toLowerCase()!==e.toLowerCase()+"\\")&&(a=e+"\\")):a=process.cwd(),fe.isString(a)){if(!a)continue}else throw new TypeError("Arguments to path.resolve must be strings");var i=Yr(a),s=i.device,u=i.isUnc,o=i.isAbsolute,h=i.tail;if(!(s&&e&&s.toLowerCase()!==e.toLowerCase())&&(e||(e=s),r||(t=h+"\\"+t,r=o),e&&r))break}return u&&(e=oa(e)),t=$t(t.split(/[\\\/]+/),!r).join("\\"),e+(r?"\\":"")+t||"."};H.normalize=function(e){var t=Yr(e),r=t.device,n=t.isUnc,a=t.isAbsolute,i=t.tail,s=/[\\\/]$/.test(i);return i=$t(i.split(/[\\\/]+/),!a).join("\\"),!i&&!a&&(i="."),i&&s&&(i+="\\"),n&&(r=oa(r)),r+(a?"\\":"")+i};H.isAbsolute=function(e){return Yr(e).isAbsolute};H.join=function(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(!fe.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&e.push(r)}var n=e.join("\\");return/^[\\\/]{2}[^\\\/]/.test(e[0])||(n=n.replace(/^[\\\/]{2,}/,"\\")),H.normalize(n)};H.relative=function(e,t){e=H.resolve(e),t=H.resolve(t);for(var r=e.toLowerCase(),n=t.toLowerCase(),a=nt(t.split("\\")),i=nt(r.split("\\")),s=nt(n.split("\\")),u=Math.min(i.length,s.length),o=u,h=0;h<u;h++)if(i[h]!==s[h]){o=h;break}if(o==0)return t;for(var l=[],h=o;h<i.length;h++)l.push("..");return l=l.concat(a.slice(o)),l.join("\\")};H._makeLong=function(e){if(!fe.isString(e))return e;if(!e)return"";var t=H.resolve(e);return/^[a-zA-Z]\:\\/.test(t)?"\\\\?\\"+t:/^\\\\[^?.]/.test(t)?"\\\\?\\UNC\\"+t.substring(2):e};H.dirname=function(e){var t=zt(e),r=t[0],n=t[1];return!r&&!n?".":(n&&(n=n.substr(0,n.length-1)),r+n)};H.basename=function(e,t){var r=zt(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r};H.extname=function(e){return zt(e)[3]};H.format=function(e){if(!fe.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!fe.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var r=e.dir,n=e.base||"";return r?r[r.length-1]===H.sep?r+n:r+H.sep+n:n};H.parse=function(e){if(!fe.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=zt(e);if(!t||t.length!==4)throw new TypeError("Invalid path '"+e+"'");return{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}};H.sep="\\";H.delimiter=";";var Ii=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Z={};function Gt(e){return Ii.exec(e).slice(1)}Z.resolve=function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:process.cwd();if(fe.isString(n)){if(!n)continue}else throw new TypeError("Arguments to path.resolve must be strings");e=n+"/"+e,t=n[0]==="/"}return e=$t(e.split("/"),!t).join("/"),(t?"/":"")+e||"."};Z.normalize=function(e){var t=Z.isAbsolute(e),r=e&&e[e.length-1]==="/";return e=$t(e.split("/"),!t).join("/"),!e&&!t&&(e="."),e&&r&&(e+="/"),(t?"/":"")+e};Z.isAbsolute=function(e){return e.charAt(0)==="/"};Z.join=function(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];if(!fe.isString(r))throw new TypeError("Arguments to path.join must be strings");r&&(e?e+="/"+r:e+=r)}return Z.normalize(e)};Z.relative=function(e,t){e=Z.resolve(e).substr(1),t=Z.resolve(t).substr(1);for(var r=nt(e.split("/")),n=nt(t.split("/")),a=Math.min(r.length,n.length),i=a,s=0;s<a;s++)if(r[s]!==n[s]){i=s;break}for(var u=[],s=i;s<r.length;s++)u.push("..");return u=u.concat(n.slice(i)),u.join("/")};Z._makeLong=function(e){return e};Z.dirname=function(e){var t=Gt(e),r=t[0],n=t[1];return!r&&!n?".":(n&&(n=n.substr(0,n.length-1)),r+n)};Z.basename=function(e,t){var r=Gt(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r};Z.extname=function(e){return Gt(e)[3]};Z.format=function(e){if(!fe.isObject(e))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);var t=e.root||"";if(!fe.isString(t))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);var r=e.dir?e.dir+Z.sep:"",n=e.base||"";return r+n};Z.parse=function(e){if(!fe.isString(e))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof e);var t=Gt(e);if(!t||t.length!==4)throw new TypeError("Invalid path '"+e+"'");return t[1]=t[1]||"",t[2]=t[2]||"",t[3]=t[3]||"",{root:t[0],dir:t[0]+t[1].slice(0,-1),base:t[2],ext:t[3],name:t[2].slice(0,t[2].length-t[3].length)}};Z.sep="/";Z.delimiter=":";Ci?ft.exports=H:ft.exports=Z;ft.exports.posix=Z;ft.exports.win32=H;var Di=ft.exports;function Ri(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}var Ki=Ri;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Fi=function(e){return e!=null&&(ua(e)||Ni(e)||!!e._isBuffer)};function ua(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function Ni(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&ua(e.slice(0,0))}var Li=Ki,qi=Fi,Ui=typeof Float64Array<"u";function $i(e,t){return e[0]-t[0]}function zi(){var e=this.stride,t=new Array(e.length),r;for(r=0;r<t.length;++r)t[r]=[Math.abs(e[r]),r];t.sort($i);var n=new Array(t.length);for(r=0;r<n.length;++r)n[r]=t[r][1];return n}function Gi(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n=e==="generic";if(t===-1){var a="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}",g=new Function(a);return g()}else if(t===0){var a="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",g=new Function("TrivialArray",a);return g(Nt[e][0])}var a=["'use strict'"],i=Li(t),s=i.map(function(d){return"i"+d}),u="this.offset+"+i.map(function(d){return"this.stride["+d+"]*i"+d}).join("+"),o=i.map(function(d){return"b"+d}).join(","),h=i.map(function(d){return"c"+d}).join(",");a.push("function "+r+"(a,"+o+","+h+",d){this.data=a","this.shape=["+o+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),a.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+i.map(function(d){return"this.shape["+d+"]"}).join("*"),"}})"),t===1?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),t<4?(a.push("function "+r+"_order(){"),t===2?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):t===3&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+r+"_set("+s.join(",")+",v){"),n?a.push("return this.data.set("+u+",v)}"):a.push("return this.data["+u+"]=v}"),a.push("proto.get=function "+r+"_get("+s.join(",")+"){"),n?a.push("return this.data.get("+u+")}"):a.push("return this.data["+u+"]}"),a.push("proto.index=function "+r+"_index(",s.join(),"){return "+u+"}"),a.push("proto.hi=function "+r+"_hi("+s.join(",")+"){return new "+r+"(this.data,"+i.map(function(d){return["(typeof i",d,"!=='number'||i",d,"<0)?this.shape[",d,"]:i",d,"|0"].join("")}).join(",")+","+i.map(function(d){return"this.stride["+d+"]"}).join(",")+",this.offset)}");var l=i.map(function(d){return"a"+d+"=this.shape["+d+"]"}),c=i.map(function(d){return"c"+d+"=this.stride["+d+"]"});a.push("proto.lo=function "+r+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+c.join(","));for(var f=0;f<t;++f)a.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");a.push("return new "+r+"(this.data,"+i.map(function(d){return"a"+d}).join(",")+","+i.map(function(d){return"c"+d}).join(",")+",b)}"),a.push("proto.step=function "+r+"_step("+s.join(",")+"){var "+i.map(function(d){return"a"+d+"=this.shape["+d+"]"}).join(",")+","+i.map(function(d){return"b"+d+"=this.stride["+d+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var f=0;f<t;++f)a.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");a.push("return new "+r+"(this.data,"+i.map(function(d){return"a"+d}).join(",")+","+i.map(function(d){return"b"+d}).join(",")+",c)}");for(var p=new Array(t),m=new Array(t),f=0;f<t;++f)p[f]="a[i"+f+"]",m[f]="b[i"+f+"]";a.push("proto.transpose=function "+r+"_transpose("+s+"){"+s.map(function(d,v){return d+"=("+d+"===undefined?"+v+":"+d+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+p.join(",")+","+m.join(",")+",this.offset)}"),a.push("proto.pick=function "+r+"_pick("+s+"){var a=[],b=[],c=this.offset");for(var f=0;f<t;++f)a.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+i.map(function(d){return"shape["+d+"]"}).join(",")+","+i.map(function(d){return"stride["+d+"]"}).join(",")+",offset)}");var g=new Function("CTOR_LIST","ORDER",a.join(`
`));return g(Nt[e],zi)}function Vi(e){if(qi(e))return"buffer";if(Ui)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}var Nt={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function Wi(e,t,r,n){if(e===void 0){var h=Nt.array[0];return h([])}else typeof e=="number"&&(e=[e]);t===void 0&&(t=[e.length]);var a=t.length;if(r===void 0){r=new Array(a);for(var i=a-1,s=1;i>=0;--i)r[i]=s,s*=t[i]}if(n===void 0){n=0;for(var i=0;i<a;++i)r[i]<0&&(n-=(t[i]-1)*r[i])}for(var u=Vi(e),o=Nt[u];o.length<=a+1;)o.push(Gi(u,o.length-1));var h=o[a+1];return h(e,t,r,n)}var Yi=Wi,Br={},Hi,Ji;function Zi(e,t,r,i){var a=0,i=i===void 0?{}:i,s=i.loop===void 0?null:i.loop,u=i.palette===void 0?null:i.palette;if(t<=0||r<=0||t>65535||r>65535)throw new Error("Width/Height invalid.");function o(d){var v=d.length;if(v<2||v>256||v&v-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return v}e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var h=0,l=0;if(u!==null){for(var c=o(u);c>>=1;)++h;if(c=1<<h,--h,i.background!==void 0){if(l=i.background,l>=c)throw new Error("Background index out of range.");if(l===0)throw new Error("Background index explicitly passed as 0.")}}if(e[a++]=t&255,e[a++]=t>>8&255,e[a++]=r&255,e[a++]=r>>8&255,e[a++]=(u!==null?128:0)|h,e[a++]=l,e[a++]=0,u!==null)for(var f=0,p=u.length;f<p;++f){var m=u[f];e[a++]=m>>16&255,e[a++]=m>>8&255,e[a++]=m&255}if(s!==null){if(s<0||s>65535)throw new Error("Loop count invalid.");e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=s&255,e[a++]=s>>8&255,e[a++]=0}var g=!1;this.addFrame=function(d,v,y,w,b,_){if(g===!0&&(--a,g=!1),_=_===void 0?{}:_,d<0||v<0||d>65535||v>65535)throw new Error("x/y invalid.");if(y<=0||w<=0||y>65535||w>65535)throw new Error("Width/Height invalid.");if(b.length<y*w)throw new Error("Not enough pixels for the frame size.");var A=!0,E=_.palette;if(E==null&&(A=!1,E=u),E==null)throw new Error("Must supply either a local or global palette.");for(var M=o(E),P=0;M>>=1;)++P;M=1<<P;var I=_.delay===void 0?0:_.delay,C=_.disposal===void 0?0:_.disposal;if(C<0||C>3)throw new Error("Disposal out of range.");var G=!1,L=0;if(_.transparent!==void 0&&_.transparent!==null&&(G=!0,L=_.transparent,L<0||L>=M))throw new Error("Transparent color index.");if((C!==0||G||I!==0)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=C<<2|(G===!0?1:0),e[a++]=I&255,e[a++]=I>>8&255,e[a++]=L,e[a++]=0),e[a++]=44,e[a++]=d&255,e[a++]=d>>8&255,e[a++]=v&255,e[a++]=v>>8&255,e[a++]=y&255,e[a++]=y>>8&255,e[a++]=w&255,e[a++]=w>>8&255,e[a++]=A===!0?128|P-1:0,A===!0)for(var R=0,X=E.length;R<X;++R){var W=E[R];e[a++]=W>>16&255,e[a++]=W>>8&255,e[a++]=W&255}return a=Qi(e,a,P<2?2:P,b),a},this.end=function(){return g===!1&&(e[a++]=59,g=!0),a},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(d){e=d},this.getOutputBufferPosition=function(){return a},this.setOutputBufferPosition=function(d){a=d}}function Qi(e,t,r,n){e[t++]=r;var a=t++,i=1<<r,s=i-1,u=i+1,o=u+1,h=r+1,l=0,c=0;function f(_){for(;l>=_;)e[t++]=c&255,c>>=8,l-=8,t===a+256&&(e[a]=255,a=t++)}function p(_){c|=_<<l,l+=h,f(8)}var m=n[0]&s,g={};p(i);for(var d=1,v=n.length;d<v;++d){var y=n[d]&s,w=m<<8|y,b=g[w];if(b===void 0){for(c|=m<<l,l+=h;l>=8;)e[t++]=c&255,c>>=8,l-=8,t===a+256&&(e[a]=255,a=t++);o===4096?(p(i),o=u+1,h=r+1,g={}):(o>=1<<h&&++h,g[w]=o++),m=y}else m=b}return p(m),p(u),f(1),a+1===t?e[a]=0:(e[a]=t-a-1,e[t++]=0),t}function Xi(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!==56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],i=a>>7,s=a&7,u=1<<s+1;e[t++],e[t++];var o=null,h=null;i&&(o=t,h=u,t+=u*3);var l=!0,c=[],f=0,p=null,m=0,g=null;for(this.width=r,this.height=n;l&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,g=e[t++]|e[t++]<<8,t++;else for(t+=12;;){var d=e[t++];if(!(d>=0))throw Error("Invalid block size");if(d===0)break;t+=d}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var v=e[t++];f=e[t++]|e[t++]<<8,p=e[t++],v&1||(p=null),m=v>>2&7,t++;break;case 254:for(;;){var d=e[t++];if(!(d>=0))throw Error("Invalid block size");if(d===0)break;t+=d}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var y=e[t++]|e[t++]<<8,w=e[t++]|e[t++]<<8,b=e[t++]|e[t++]<<8,_=e[t++]|e[t++]<<8,A=e[t++],E=A>>7,M=A>>6&1,P=A&7,I=1<<P+1,C=o,G=h,L=!1;if(E){var L=!0;C=t,G=I,t+=I*3}var R=t;for(t++;;){var d=e[t++];if(!(d>=0))throw Error("Invalid block size");if(d===0)break;t+=d}c.push({x:y,y:w,width:b,height:_,has_local_palette:L,palette_offset:C,palette_size:G,data_offset:R,data_length:t-R,transparent_index:p,interlaced:!!M,delay:f,disposal:m});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return g},this.frameInfo=function(X){if(X<0||X>=c.length)throw new Error("Frame index out of range.");return c[X]},this.decodeAndBlitFrameBGRA=function(X,W){var B=this.frameInfo(X),k=B.width*B.height,x=new Uint8Array(k);pn(e,B.data_offset,x,k);var j=B.palette_offset,K=B.transparent_index;K===null&&(K=256);var U=B.width,F=r-U,D=U,N=(B.y*r+B.x)*4,Y=((B.y+B.height)*r+B.x)*4,$=N,oe=F*4;B.interlaced===!0&&(oe+=r*4*7);for(var ve=8,ue=0,Ye=x.length;ue<Ye;++ue){var ye=x[ue];if(D===0&&($+=oe,D=U,$>=Y&&(oe=F*4+r*4*(ve-1),$=N+(U+F)*(ve<<1),ve>>=1)),ye===K)$+=4;else{var Vt=e[j+ye*3],Wt=e[j+ye*3+1],Yt=e[j+ye*3+2];W[$++]=Yt,W[$++]=Wt,W[$++]=Vt,W[$++]=255}--D}},this.decodeAndBlitFrameRGBA=function(X,W){var B=this.frameInfo(X),k=B.width*B.height,x=new Uint8Array(k);pn(e,B.data_offset,x,k);var j=B.palette_offset,K=B.transparent_index;K===null&&(K=256);var U=B.width,F=r-U,D=U,N=(B.y*r+B.x)*4,Y=((B.y+B.height)*r+B.x)*4,$=N,oe=F*4;B.interlaced===!0&&(oe+=r*4*7);for(var ve=8,ue=0,Ye=x.length;ue<Ye;++ue){var ye=x[ue];if(D===0&&($+=oe,D=U,$>=Y&&(oe=F*4+r*4*(ve-1),$=N+(U+F)*(ve<<1),ve>>=1)),ye===K)$+=4;else{var Vt=e[j+ye*3],Wt=e[j+ye*3+1],Yt=e[j+ye*3+2];W[$++]=Vt,W[$++]=Wt,W[$++]=Yt,W[$++]=255}--D}}}function pn(e,t,r,n){for(var a=e[t++],i=1<<a,s=i+1,u=s+1,o=a+1,h=(1<<o)-1,l=0,c=0,f=0,p=e[t++],m=new Int32Array(4096),g=null;;){for(;l<16&&p!==0;)c|=e[t++]<<l,l+=8,p===1?p=e[t++]:--p;if(l<o)break;var d=c&h;if(c>>=o,l-=o,d===i){u=s+1,o=a+1,h=(1<<o)-1,g=null;continue}else if(d===s)break;for(var v=d<u?d:g,y=0,w=v;w>i;)w=m[w]>>8,++y;var b=w,_=f+y+(v!==d?1:0);if(_>n){console.log("Warning, gif stream longer than expected.");return}r[f++]=b,f+=y;var A=f;for(v!==d&&(r[f++]=b),w=v;y--;)w=m[w],r[--A]=w&255,w>>=8;g!==null&&u<4096&&(m[u++]=g<<8|b,u>=h+1&&o<12&&(++o,h=h<<1|1)),g=d}return f!==n&&console.log("Warning, gif stream shorter than expected."),r}try{Ji=Br.GifWriter=Zi,Hi=Br.GifReader=Xi}catch{}function es(e,t){for(var r=1,n=e.length,a=e[0],i=e[0],s=1;s<n;++s)if(i=a,a=e[s],t(a,i)){if(s===r){r++;continue}e[r++]=a}return e.length=r,e}function ts(e){for(var t=1,r=e.length,n=e[0],a=e[0],i=1;i<r;++i,a=n)if(a=n,n=e[i],n!==a){if(i===t){t++;continue}e[t++]=n}return e.length=t,e}function rs(e,t,r){return e.length===0?e:t?(r||e.sort(t),es(e,t)):(r||e.sort(),ts(e))}var ns=rs,as=ns;function la(e,t,r){var n=e.length,a=t.arrayArgs.length,i=t.indexArgs.length>0,s=[],u=[],o=0,h=0,l,c;for(l=0;l<n;++l)u.push(["i",l,"=0"].join(""));for(c=0;c<a;++c)for(l=0;l<n;++l)h=o,o=e[l],l===0?u.push(["d",c,"s",l,"=t",c,"p",o].join("")):u.push(["d",c,"s",l,"=(t",c,"p",o,"-s",h,"*t",c,"p",h,")"].join(""));for(u.length>0&&s.push("var "+u.join(",")),l=n-1;l>=0;--l)o=e[l],s.push(["for(i",l,"=0;i",l,"<s",o,";++i",l,"){"].join(""));for(s.push(r),l=0;l<n;++l){for(h=o,o=e[l],c=0;c<a;++c)s.push(["p",c,"+=d",c,"s",l].join(""));i&&(l>0&&s.push(["index[",h,"]-=s",h].join("")),s.push(["++index[",o,"]"].join(""))),s.push("}")}return s.join(`
`)}function is(e,t,r,n){for(var a=t.length,i=r.arrayArgs.length,s=r.blockSize,u=r.indexArgs.length>0,o=[],h=0;h<i;++h)o.push(["var offset",h,"=p",h].join(""));for(var h=e;h<a;++h)o.push(["for(var j"+h+"=SS[",t[h],"]|0;j",h,">0;){"].join("")),o.push(["if(j",h,"<",s,"){"].join("")),o.push(["s",t[h],"=j",h].join("")),o.push(["j",h,"=0"].join("")),o.push(["}else{s",t[h],"=",s].join("")),o.push(["j",h,"-=",s,"}"].join("")),u&&o.push(["index[",t[h],"]=j",h].join(""));for(var h=0;h<i;++h){for(var l=["offset"+h],c=e;c<a;++c)l.push(["j",c,"*t",h,"p",t[c]].join(""));o.push(["p",h,"=(",l.join("+"),")"].join(""))}o.push(la(t,r,n));for(var h=e;h<a;++h)o.push("}");return o.join(`
`)}function ss(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}function rr(e,t,r){for(var n=e.body,a=[],i=[],s=0;s<e.args.length;++s){var u=e.args[s];if(!(u.count<=0)){var o=new RegExp(u.name,"g"),h="",l=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case"offset":var c=t.offsetArgIndex.indexOf(s),f=t.offsetArgs[c];l=f.array,h="+q"+c;case"array":h="p"+l+h;var p="l"+s,m="a"+l;if(t.arrayBlockIndices[l]===0)u.count===1?r[l]==="generic"?u.lvalue?(a.push(["var ",p,"=",m,".get(",h,")"].join("")),n=n.replace(o,p),i.push([m,".set(",h,",",p,")"].join(""))):n=n.replace(o,[m,".get(",h,")"].join("")):n=n.replace(o,[m,"[",h,"]"].join("")):r[l]==="generic"?(a.push(["var ",p,"=",m,".get(",h,")"].join("")),n=n.replace(o,p),u.lvalue&&i.push([m,".set(",h,",",p,")"].join(""))):(a.push(["var ",p,"=",m,"[",h,"]"].join("")),n=n.replace(o,p),u.lvalue&&i.push([m,"[",h,"]=",p].join("")));else{for(var g=[u.name],d=[h],v=0;v<Math.abs(t.arrayBlockIndices[l]);v++)g.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(v+1)+"*t"+l+"b"+v);if(o=new RegExp(g.join(""),"g"),h=d.join("+"),r[l]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(o,[m,"[",h,"]"].join(""))}break;case"scalar":n=n.replace(o,"Y"+t.scalarArgs.indexOf(s));break;case"index":n=n.replace(o,"index");break;case"shape":n=n.replace(o,"shape");break}}}return[a.join(`
`),n,i.join(`
`)].join(`
`).trim()}function os(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var a=e[n],i=a.match(/\d+/);i?i=i[0]:i="",a.charAt(0)===0?t[n]="u"+a.charAt(1)+i:t[n]=a.charAt(0)+i,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}function us(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,n=new Array(e.arrayArgs.length),a=new Array(e.arrayArgs.length),i=0;i<e.arrayArgs.length;++i)a[i]=t[2*i],n[i]=t[2*i+1];for(var s=[],u=[],o=[],h=[],l=[],i=0;i<e.arrayArgs.length;++i){e.arrayBlockIndices[i]<0?(o.push(0),h.push(r),s.push(r),u.push(r+e.arrayBlockIndices[i])):(o.push(e.arrayBlockIndices[i]),h.push(e.arrayBlockIndices[i]+r),s.push(0),u.push(e.arrayBlockIndices[i]));for(var c=[],f=0;f<n[i].length;f++)o[i]<=n[i][f]&&n[i][f]<h[i]&&c.push(n[i][f]-o[i]);l.push(c)}for(var p=["SS"],m=["'use strict'"],g=[],f=0;f<r;++f)g.push(["s",f,"=SS[",f,"]"].join(""));for(var i=0;i<e.arrayArgs.length;++i){p.push("a"+i),p.push("t"+i),p.push("p"+i);for(var f=0;f<r;++f)g.push(["t",i,"p",f,"=t",i,"[",o[i]+f,"]"].join(""));for(var f=0;f<Math.abs(e.arrayBlockIndices[i]);++f)g.push(["t",i,"b",f,"=t",i,"[",s[i]+f,"]"].join(""))}for(var i=0;i<e.scalarArgs.length;++i)p.push("Y"+i);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){for(var d=new Array(r),i=0;i<r;++i)d[i]="0";g.push(["index=[",d.join(","),"]"].join(""))}for(var i=0;i<e.offsetArgs.length;++i){for(var v=e.offsetArgs[i],y=[],f=0;f<v.offset.length;++f)v.offset[f]!==0&&(v.offset[f]===1?y.push(["t",v.array,"p",f].join("")):y.push([v.offset[f],"*t",v.array,"p",f].join("")));y.length===0?g.push("q"+i+"=0"):g.push(["q",i,"=",y.join("+")].join(""))}var w=as([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));g=g.concat(w),g.length>0&&m.push("var "+g.join(","));for(var i=0;i<e.arrayArgs.length;++i)m.push("p"+i+"|=0");e.pre.body.length>3&&m.push(rr(e.pre,e,a));var b=rr(e.body,e,a),_=ss(l);_<r?m.push(is(_,l[0],e,b)):m.push(la(l[0],e,b)),e.post.body.length>3&&m.push(rr(e.post,e,a)),e.debug&&console.log("-----Generated cwise routine for ",t,`:
`+m.join(`
`)+`
----------`);var A=[e.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",_,os(a)].join(""),E=new Function(["function ",A,"(",p.join(","),"){",m.join(`
`),"} return ",A].join(""));return E()}var ls=us,cs=ls;function hs(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var a=[],i=[],s=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],u=[],o=[],h=0;h<e.arrayArgs.length;++h){var l=e.arrayArgs[h];r.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),a.push("t"+l),a.push("r"+l),i.push("t"+l),i.push("r"+l+".join()"),s.push("array"+l+".data"),s.push("array"+l+".stride"),s.push("array"+l+".offset|0"),h>0&&(u.push("array"+e.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[h]))),o.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[h])+"]"))}e.arrayArgs.length>1&&(t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),t.push("if (!("+o.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}"));for(var h=0;h<e.scalarArgs.length;++h)s.push("scalar"+e.scalarArgs[h]);r.push(["type=[",i.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",s.join(","),")}"].join("")),e.debug&&console.log(`-----Generated thunk:
`+t.join(`
`)+`
----------`);var c=new Function("compile",t.join(`
`));return c(cs.bind(void 0,e))}var fs=hs,ds=fs;function ps(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function vs(e){var t=new ps;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var a=r[n];if(a==="array"||typeof a=="object"&&a.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if(a==="scalar")t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if(a==="index"){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if(a==="shape"){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof a=="object"&&a.offset)t.argTypes[n]="offset",t.offsetArgs.push({array:a.array,offset:a.offset}),t.offsetArgIndex.push(n);else throw new Error("cwise: Unknown argument type "+r[n])}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,ds(t)}var ys=vs;ys({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:`{
var _inline_1_v=_inline_1_arg1_,_inline_1_i
for(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {
_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]
}
_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]
}`,args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64});var gs={exports:{}};const ms={},ws=Object.freeze(Object.defineProperty({__proto__:null,default:ms},Symbol.toStringTag,{value:"Module"})),bs=ha(ws);(function(e,t){var r=bs;e.exports=n,n.through=n;function n(a,i,s){a=a||function(m){this.queue(m)},i=i||function(){this.queue(null)};var u=!1,o=!1,h=[],l=!1,c=new r;c.readable=c.writable=!0,c.paused=!1,c.autoDestroy=!(s&&s.autoDestroy===!1),c.write=function(m){return a.call(this,m),!c.paused};function f(){for(;h.length&&!c.paused;){var m=h.shift();if(m===null)return c.emit("end");c.emit("data",m)}}c.queue=c.push=function(m){return l||(m===null&&(l=!0),h.push(m),f()),c},c.on("end",function(){c.readable=!1,!c.writable&&c.autoDestroy&&process.nextTick(function(){c.destroy()})});function p(){c.writable=!1,i.call(c),!c.readable&&c.autoDestroy&&c.destroy()}return c.end=function(m){if(!u)return u=!0,arguments.length&&c.write(m),p(),c},c.destroy=function(){if(!o)return o=!0,u=!0,h.length=0,c.writable=c.readable=!1,c.emit("close"),c},c.pause=function(){if(!c.paused)return c.paused=!0,c},c.resume=function(){return c.paused&&(c.paused=!1,c.emit("resume")),f(),c.paused||c.emit("drain"),c},c}})(gs);var _s=ks;function ks(e){if(!/^data\:/i.test(e))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');e=e.replace(/\r?\n/g,"");var t=e.indexOf(",");if(t===-1||t<=4)throw new TypeError("malformed data: URI");for(var r=e.substring(5,t).split(";"),n=!1,a="US-ASCII",i=0;i<r.length;i++)r[i]=="base64"?n=!0:r[i].indexOf("charset=")==0&&(a=r[i].substring(8));var s=unescape(e.substring(t+1)),u=n?"base64":"ascii",o=new Buffer(s,u);return o.type=r[0]||"text/plain",o.charset=a,o}var Es=Di,Ir=Yi,As=Br.GifReader,xs=_s;function Ps(e,t){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var n=document.createElement("canvas");n.width=r.width,n.height=r.height;var a=n.getContext("2d");a.drawImage(r,0,0);var i=a.getImageData(0,0,r.width,r.height);t(null,Ir(new Uint8Array(i.data),[r.width,r.height,4],[4,4*r.width,1],0))},r.onerror=function(n){t(n)},r.src=e}function ca(e,t){var r;try{r=new As(e)}catch(u){t(u);return}if(r.numFrames()>0){var n=[r.numFrames(),r.height,r.width,4],a=new Uint8Array(n[0]*n[1]*n[2]*n[3]),i=Ir(a,n);try{for(var s=0;s<r.numFrames();++s)r.decodeAndBlitFrameRGBA(s,a.subarray(i.index(s,0,0,0),i.index(s+1,0,0,0)))}catch(u){t(u);return}t(null,i.transpose(0,2,1))}else{var n=[r.height,r.width,4],a=new Uint8Array(n[0]*n[1]*n[2]),i=Ir(a,n);try{r.decodeAndBlitFrameRGBA(0,a)}catch(l){t(l);return}t(null,i.transpose(1,0))}}function js(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.overrideMimeType&&r.overrideMimeType("application/binary"),r.onerror=function(n){t(n)},r.onload=function(){if(r.readyState===4){var n=new Uint8Array(r.response);ca(n,t)}},r.send()}function Ms(e){if(e[0]===void 0){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;++n)r[n]=e.get(n);return r}else return new Uint8Array(e)}function Os(e,t){process.nextTick(function(){try{var r=xs(e);r?ca(Ms(r),t):t(new Error("Error parsing data URI"))}catch(n){t(n)}})}var Ts=function(t,r,n){n||(n=r,r="");var a=Es.extname(t);switch(r||a.toUpperCase()){case".GIF":js(t,n);break;default:Buffer.isBuffer(t)&&(t="data:"+r+";base64,"+t.toString("base64")),t.indexOf("data:image/gif;")===0?Os(t,n):Ps(t,n)}};const Ss=vn(Ts);async function Cs(e){let n=0,a=null,i=null,s=[],u=[];if(e.features){let w=[];return e.features.forEach(b=>{if(b.geometry.type=="LineString"){let _=ln(b);w.push({route:b,alongPadding:n,start:b.geometry.coordinates[0]}),n+=_;return}if(b.geometry.type=="MultiLineString"){b.geometry.coordinates.forEach(_=>{let A={geometry:{type:"LineString",coordinates:_},type:"Feature"},E=ln(A);w.push({route:A,alongPadding:n,start:_[0]}),n+=E});return}}),new Promise((b,_)=>{try{s=[],u=[];var A=o(n,w[0][1],200);let E=h(w,A);c(w,13,13),l(E,13),Promise.all(u).then(function(){m(E);let M=E.map(P=>P.properties.elevation).filter(P=>Number.isInteger(P));i=Math.min(...M),a=Math.max(...M),b({minElevation:i,maxElevation:a,length:n,elevations:v(E)})}).catch(function(M){_(M)})}catch(E){_(E)}})}else return[];function o(w,b,_){let A=Math.ceil(y(b)*10)/1e4,E=w/(_-1);A!==null&&E<A&&(E=A);let M=[];for(let P=0;P<_-1&&E*P<w;P++)M.push(E*P);return M.push(w),M}function h(w,b){let _=[],A=0;return b.forEach(function(E){for(;E<w[A].alongPadding;)A++;let M=li(w[A].route,E-w[A].alongPadding,{units:"kilometers"});M.properties.distanceAlongLine=(E-w[A].alongPadding)*1e3,_.push(M)}),_}function l(w,b){let _=new vi({size:256});w.forEach(function(A){let E=_.px([A.geometry.coordinates[0],A.geometry.coordinates[1]],b);A.properties.smCoordinates={x:E[0],y:E[1]}})}function c(w,b,_){w.reduce((E,M)=>(console.log(E),console.log(M),E.push(...Ut.tiles(M.route.geometry,{min_zoom:b,max_zoom:_})),E),[]).forEach(function(E,M){let P=E[0],I=E[1],C=E[2];s.push({coordinates:{x:P,y:I,z:C},smCoordinates:{x:P*256,y:I*256},tileData:null}),f(P,I,C,M)})}function f(w,b,_,A){u.push(p(w,b,_).then(function(E){s[A].tileData=E}))}function p(w,b,_){return new Promise((A,E)=>{Ss(`https://cdn.jsdelivr.net/gh/HillHeadism/HKTiles@0.0.1/terrain_rgb/${_}/${w}/${b}.png`,function(M,P){M&&E(M),A(P)})})}function m(w){w.forEach(function(b){let _=s.filter(function(M){return d(b.properties.smCoordinates,M.smCoordinates)})[0],A=b.properties.smCoordinates.x-_.smCoordinates.x,E=b.properties.smCoordinates.y-_.smCoordinates.y;b.properties.elevation=g([_.tileData.get(A,E,0),_.tileData.get(A,E,1),_.tileData.get(A,E,2)])})}function g(w){let b=w[0],_=w[1],A=w[2];return-1e4+(b*256*256+_*256+A)*.1}function d(w,b){return w.x>=b.x&&w.x<=b.x+256&&w.y>=b.y&&w.y<=b.y+256}function v(w){let b={type:"FeatureCollection",features:[]};return w.forEach(function(_){let A=JSON.parse(JSON.stringify(_));delete A.properties.smCoordinates,b.features.push(A)}),b}function y(w){return 40075016686e-3*(Math.cos(w*Math.PI/180)/Math.pow(2,21))}}const Is={getDB(){var e=new je("Routes");return e.version(1).stores({routes:"&_id,name,desc,minElevation,maxElevation,length",geoJSON:"&_id,geoJSON"}),console.log("Using Dexie v"+je.semVer),e},async addRoute(e){var t=Object.assign({},e);e.name||(e.name=e.fileName);let r=await Cs(t);return Object.assign(e,r),delete e.features,await this.getDB().routes.add(e),await this.getDB().geoJSON.add(t),e._id},async getRoutes(){return await this.getDB().routes.toArray()},async getRoute(e){return await this.getDB().routes.get(e)},async getRouteWithData(e){const t=await this.getDB().routes.get(e);return t.geoJSON=await this.getDB().geoJSON.get(e),t},async deleteRoute(e){await this.getDB().routes.delete(e),await this.getDB().geoJSON.delete(e)},async updateRoute(e){await this.getDB().routes.update(e._id,e)}};export{vn as a,Jn as b,Bs as c,Is as d,ha as g,Fi as i};
